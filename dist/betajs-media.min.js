/*!
betajs-media - v0.0.192 - 2022-11-21
Copyright (c) Ziggeo,Oliver Friedmann,Rashad Aliyev
Apache-2.0 Software License.
*/
var Scoped=function(){var p=function(){return{get:function(e){return"undefined"!=typeof window?e?window[e]:window:"undefined"!=typeof global?e?global[e]:global:"undefined"!=typeof self?e?self[e]:self:undefined},set:function(e,t){return"undefined"!=typeof window&&(window[e]=t),"undefined"!=typeof global&&(global[e]=t),"undefined"!=typeof self&&(self[e]=t),t},getPath:function(e){if(!e)return this.get();var t=e.split(".");if(1==t.length)return this.get(e);for(var i=this.get(t[0]),r=1;r<t.length;++r){if(!i)return i;i=i[t[r]]}return i},setPath:function(e,t){var i=e.split(".");if(1==i.length)return this.set(e,t);for(var r=this.get(i[0])||this.set(i[0],{}),n=1;n<i.length-1;++n)i[n]in r||(r[i[n]]={}),r=r[i[n]];return r[i[i.length-1]]=t}}}.call(this),_=function(){return{method:function(e,t){return function(){return t.apply(e,arguments)}},extend:function(e,t){for(var i in e=e||{},t=t||{})e[i]=t[i];return e},typeOf:function(e){return"[object Array]"===Object.prototype.toString.call(e)?"array":typeof e},isEmpty:function(e){if(null!=e){if("array"==this.typeOf(e))return 0===e.length;if("object"!=typeof e)return!1;for(var t in e)return!1}return!0},matchArgs:function(e,t){var i,r=0,n={};for(i in t)!0===t[i]||this.typeOf(e[r])==t[i]?(n[i]=e[r],r++):"undefined"==this.typeOf(e[r])&&r++;return n},stringify:function(e){return"function"==this.typeOf(e)?""+e:JSON.stringify(e)}}}.call(this),s=function(){return{__namespace:"Scoped",__revert:null,upgrade:function(e){var t=p.get(e||s.__namespace);if(t&&"object"===_.typeOf(t)&&t.guid===this.guid&&"string"===_.typeOf(t.version)){if(!1===this.upgradable||!1===t.upgradable)return t;for(var i=this.version.split("."),r=t.version.split("."),n=!1,o=0;o<Math.min(i.length,r.length)&&(n=parseInt(i[o],10)>parseInt(r[o],10),i[o]===r[o]);++o);return n?this.attach(e):t}return this.attach(e)},attach:function(e){e&&(s.__namespace=e);e=p.get(s.__namespace);if(e!==this){if(s.__revert=e)try{var t=e.__exportScoped();this.__exportBackup=this.__exportScoped(),this.__importScoped(t)}catch(i){}p.set(s.__namespace,this)}return this},detach:function(e){return e&&p.set(s.__namespace,null),"undefined"!=typeof s.__revert&&p.set(s.__namespace,s.__revert),delete s.__revert,s.__exportBackup&&this.__importScoped(s.__exportBackup),this},exports:function(e,t,i){return"object"==typeof(e=e||("undefined"!=typeof module?module:null))&&e&&"exports"in e&&(i||e.exports===this||!e.exports||_.isEmpty(e.exports))&&(e.exports=t||this),this}}}.call(this);function m(e){var s={tree:"boolean"==typeof e.tree&&e.tree,global:"boolean"==typeof e.global&&e.global,root:"object"==typeof e.root?e.root:{}};function n(e){return{route:"string"==typeof e.route?e.route:null,parent:"object"==typeof e.parent?e.parent:null,ready:"boolean"==typeof e.ready&&e.ready,children:{},watchers:[],data:{},lazy:[]}}var o=n({ready:!0});if(s.tree)if(s.global){try{window&&(o.data=window)}catch(t){}try{global&&(o.data=global)}catch(t){}try{self&&(o.data=self)}catch(t){}}else o.data=s.root;function a(e){if(!e.ready)if(e.parent&&!e.parent.ready)a(e.parent);else if(e.route&&e.parent&&e.route in e.parent.data){e.data=e.parent.data[e.route],e.ready=!0;for(var t,i=0;i<e.watchers.length;++i)e.watchers[i].callback.call(e.watchers[i].context||this,e.data);for(t in e.watchers=[],e.children)a(e.children[t])}}function d(e,t){if("object"==typeof t&&e.ready)for(var i in t)e.data[i]=t[i];else e.data=t;if("object"==typeof t)for(var r in t)e.children[r]&&(e.children[r].data=t[r]);for(var n in!function o(e){if(!e.ready){e.parent&&!e.parent.ready&&o(e.parent),e.ready=!0,e.parent&&s.tree&&"object"==typeof e.parent.data&&(e.parent.data[e.route]=e.data);for(var t=0;t<e.watchers.length;++t)e.watchers[t].callback.call(e.watchers[t].context||this,e.data);e.watchers=[]}}(e),e.children)a(e.children[n])}function c(e){if(!e)return o;for(var t=e.split("."),i=o,r=0;r<t.length;++r)t[r]in i.children?i=i.children[t[r]]:(i.children[t[r]]=n({parent:i,route:t[r]}),a(i=i.children[t[r]]));return i}return{extend:function(e,t){d(c(e),t)},set:function(e,t){e=c(e);if(e.data){var i=e;if(i.ready&&i.data)for(var r in i.data)delete i.data[r]}d(e,t)},get:function(e){e=c(e);return e.ready?e.data:null},lazy:function(e,t,i){e=c(e);e.ready?t(i||this,e.data):e.lazy.push({callback:t,context:i})},digest:function(e){a(c(e))},obtain:function(e,t,i){!function(e,t,i){var r;e.ready?t.call(i||this,e.data):(e.watchers.push({callback:t,context:i}),0<e.lazy.length&&(r=function(e){var t;0<e.lazy.length&&((t=e.lazy.shift()).callback.call(t.context||this,e.data),r(e))})(e))}(c(e),t,i)},unresolvedWatchers:function(e){return function n(e,t,i){for(var r in i=i||[],!(e=e||o).ready&&0===e.lazy.length&&0<e.watchers.length&&i.push(t),e.children)r=e.children[r],i=n(r,(t?t+".":"")+r.route,i);return i}(c(e),e)},__export:function(){return{options:s,nsRoot:o}},__import:function(e){s=e.options,o=e.nsRoot}}}var t=m({tree:!0,global:!0}),i=m({tree:!0}),r=function f(e,t,i,r){var n=null,o=[],s=t,a=i,d=r,c=m({tree:!0}),u=m({tree:!1}),h={global:{namespace:d},root:{namespace:a},local:{namespace:c},"default":{namespace:u},parent:{namespace:s},scope:{namespace:c,readonly:!1}},l=function(o,s,a){var d=_.matchArgs(o,{options:"object",namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),e=_.extend({lazy:this.options.lazy},d.options||{}),c=this.resolve(d.namespaceLocator),t=function(){this.require(d.dependencies,d.hiddenDependencies,function(){for(var e=[],t=0;t<arguments.length;++t)e.push(arguments[t]);if(e[e.length-1].ns=c,this.options.compile){for(var i=[],r=0;r<o.length;++r)i.push(_.stringify(o[r]));this.compiled+=this.options.ident+"."+s+"("+i.join(", ")+");\n\n"}this.options.dependencies&&(this.dependencies[c.path]=this.dependencies[c.path]||{},d.dependencies&&d.dependencies.forEach(function(e){this.dependencies[c.path][this.resolve(e).path]=!0},this),d.hiddenDependencies)&&d.hiddenDependencies.forEach(function(e){this.dependencies[c.path][this.resolve(e).path]=!0},this);var n=this.options.compile?{}:d.callback.apply(d.context||this,e);a.call(this,c,n)},this)};return e.lazy?c.namespace.lazy(c.path,t,this):t.apply(this),this};return{getGlobal:_.method(p,p.getPath),setGlobal:_.method(p,p.setPath),options:{lazy:!1,ident:"Scoped",compile:!1,dependencies:!1},compiled:"",dependencies:{},nextScope:function(){return n=n||f(0,c,a,d)},subScope:function(){var e=this.nextScope();return o.push(e),n=null,e},binding:function(e,t,i){return h[e]&&h[e].readonly||(t="string"!=_.typeOf(t)?{namespace:m({tree:!0,root:t}),path:null}:this.resolve(t),h[e]=_.extend(i,t)),this},resolve:function(e){if(1==(e=e.split(":")).length)throw"The locator '"+e[0]+"' requires a namespace.";var t=h[e[0]];if(t)return{namespace:t.namespace,path:t.path&&e[1]?t.path+"."+e[1]:t.path||e[1]};throw"The namespace '"+e[0]+"' has not been defined (yet)."},define:function(){return l.call(this,arguments,"define",function(e,t){if(e.namespace.get(e.path))throw"Scoped namespace "+e.path+" has already been defined. Use extend to extend an existing namespace instead";e.namespace.set(e.path,t)})},assumeVersion:function(){var o=_.matchArgs(arguments,{assumption:!0,dependencies:"array",callback:!0,context:"object",error:"string"}),e=o.dependencies||[];e.unshift(o.assumption),this.require(e,function(){var e=arguments,t=e[0].replace(/[^\d\.]/g,"");e[0]=t.split(".");for(var i=0;i<e[0].length;++i)e[0][i]=parseInt(e[0][i],10);if("function"===_.typeOf(o.callback)){if(!o.callback.apply(o.context||this,o))throw"Scoped Assumption '"+o.assumption+"' failed, value is "+t+(o.error?", but assuming "+o.error:"")}else for(var r=(o.callback+"").replace(/[^\d\.]/g,"").split("."),n=0;n<Math.min(e[0].length,r.length);++n)if(parseInt(r[n],10)>e[0][n])throw"Scoped Version Assumption '"+o.assumption+"' failed, value is "+t+", but assuming at least "+o.callback})},extend:function(){return l.call(this,arguments,"extend",function(e,t){e.namespace.extend(e.path,t)})},require:function(){var t=_.matchArgs(arguments,{dependencies:"array",hiddenDependencies:"array",callback:"function",context:"object"}),e=(t.callback=t.callback||function(){},t.dependencies||[]),i=e.concat(t.hiddenDependencies||[]),r=i.length,n=[],o={};if(r)for(var s=function(e){this.i<n.length&&(n[this.i]=e),0==--r&&(n.push(o),t.callback.apply(t.context||this.ctx,n))},a=0;a<i.length;++a){var d=this.resolve(i[a]);a<e.length&&n.push(null),d.namespace.obtain(d.path,s,{ctx:this,i:a})}else n.push(o),t.callback.apply(t.context||this,n);return this},digest:function(e){return(e=this.resolve(e)).namespace.digest(e.path),this},unresolved:function(e){return(e=this.resolve(e)).namespace.unresolvedWatchers(e.path)},__export:function(){return{parentNamespace:s.__export(),rootNamespace:a.__export(),globalNamespace:d.__export(),localNamespace:c.__export(),privateNamespace:u.__export()}},__import:function(e){s.__import(e.parentNamespace),a.__import(e.rootNamespace),d.__import(e.globalNamespace),c.__import(e.localNamespace),u.__import(e.privateNamespace)}}}(0,i,i,t),e=_.extend(r,function(){return{guid:"4b6878ee-cb6a-46b3-94ac-27d91f58d666",version:"0.0.22",upgradable:!0,upgrade:s.upgrade,attach:s.attach,detach:s.detach,exports:s.exports,__exportScoped:function(){return{globalNamespace:t.__export(),rootNamespace:i.__export(),rootScope:r.__export()}},__importScoped:function(e){t.__import(e.globalNamespace),i.__import(e.rootNamespace),r.__import(e.rootScope)}}}.call(this));return(e=e.upgrade()).exports(),e}.call(this);!function(){var e=this.subScope();e.binding("module","global:BetaJS.Media"),e.binding("base","global:BetaJS"),e.binding("browser","global:BetaJS.Browser"),e.define("module:",function(){return{guid:"8475efdb-dd7e-402e-9f50-36c76945a692",version:"0.0.192",datetime:1669069247824}}),e.assumeVersion("base:version","~1.0.136"),e.assumeVersion("browser:version","~1.0.61"),e.define("module:AudioPlayer.AudioPlayerWrapper",["base:Classes.OptimisticConditionalInstance","base:Events.EventsMixin","base:Types","base:Objs","base:Promise","base:Strings","browser:Events"],function(e,t,n,o,i,s,a,r){return e.extend({scoped:r},[t,function(r){return{constructor:function(e,t){r.constructor.call(this);var t=(e=o.extend(o.clone(e||{},1),t)).source||e.sources||[],i=(n.is_string(t)?t=t.split(" "):n.is_array(t)||(t=[t]),[]);o.iter(t,function(e){var t;n.is_string(e)?e={src:e.trim()}:"undefined"!=typeof Blob&&e instanceof Blob&&(e={src:e}),e.ext&&!e.type&&(e.type="audio/"+e.ext),!e.ext&&e.type&&(e.ext=s.last_after(e.type,"/")),e.ext||e.type||!n.is_string(e.src)||0<=(t=s.splitFirst(e.src,"?").head).indexOf(".")&&(e.ext=s.last_after(t,"."),e.type="audio/"+e.ext),e.ext&&(e.ext=e.ext.toLowerCase()),e.type&&(e.type=e.type.toLowerCase()),"undefined"!=typeof Blob&&e.src instanceof Blob&&(e.src=(window.URL||window.webkitURL).createObjectURL(e.src)),i.push(e)},this),this._sources=i,this._element=e.element,this._preload=e.preload||!1,this._reloadonplay=e.reloadonplay||!1,this._options=e,this._loop=e.loop||!1,this._loaded=!1,this._error=0,this._domEvents=new a},destroy:function(){this._domEvents.destroy(),r.destroy.call(this)},sources:function(){return this._sources},loaded:function(){return this._loaded},buffered:function(){},_eventLoaded:function(){this._loaded=!0,this.trigger("loaded")},_eventLoadedMetaData:function(e){this._hasMetadata=!0,this.trigger("loadedmetadata",e.target)},_eventPlaying:function(){this._loaded||this._eventLoaded(),this.trigger("playing")},_eventPaused:function(){this.trigger("paused")},_eventEnded:function(){this._loop&&this.play(),this.trigger("ended")},_eventError:function(e){this._error=e,this.trigger("error",e)},duration:function(){return this._element.duration},position:function(){return this._element.currentTime},error:function(){return this._error},play:function(){this._reloadonplay&&this._element.load(),this._reloadonplay=!1;var e=this._element.play();if(e)return i.fromNativePromise(e)},pause:function(){this._element.pause()},setPosition:function(e){this._element.currentTime=e},muted:function(){return this._element.muted},setMuted:function(e){this._element.muted=e},volume:function(){return this._element.volume},setVolume:function(e){this._element.volume=e}}}],{ERROR_NO_PLAYABLE_SOURCE:1})}),e.define("module:AudioPlayer.Html5AudioPlayerWrapper",["module:AudioPlayer.AudioPlayerWrapper","browser:Info","base:Promise","base:Objs","base:Timers.Timer","base:Strings","base:Async","browser:Dom","browser:Events"],function(e,p,_,m,f,g,r,v,y,t){return e.extend({scoped:t},function(e){return{_initialize:function(){if(this._options.nohtml5)return _.error(!0);if(this._sources.length<1)return _.error(!0);if(p.isInternetExplorer()&&p.internetExplorerVersion()<9)return _.error(!0);var t,e,i=_.create(),r=(this._element.innerHTML="",this.sources()),n=p.isInternetExplorer()&&9==p.internetExplorerVersion()||p.isWindowsPhone(),o=("audio"!==this._element.tagName.toLowerCase()?(this._element=v.changeTag(this._element,"audio"),this._transitionals.element=this._element):n&&(t=g.splitLast(this._element.outerHTML,"</audio>").head,m.iter(r,function(e){t+="<source"+(e.type?" type='"+e.type+"'":"")+" src='"+e.src+"' />"}),t+="</audio>",e=v.elementByTemplate(t),v.elementInsertAfter(e,this._element),this._element.parentNode.removeChild(this._element),this._element=e,this._transitionals.element=this._element),p.isSafari()&&p.safariVersion()<6&&(this._element.src=r[0].src,this._preload=!0),this._domEvents.on(this._element,"loadevent",function(){this._element.networkState===this._element.NETWORK_NO_SOURCE?i.asyncError(!0):i.asyncSuccess(!0)},this),this._loaded=!1,this._domEvents.on(this._element,"canplay",this._eventLoaded,this),this._domEvents.on(this._element,"loadedmetadata",this._eventLoadedMetaData,this),10),s=new f({context:this,fire:function(){this._element.networkState===this._element.NETWORK_NO_SOURCE?--o<=0&&i.asyncError(!0):(this._element.networkState===this._element.NETWORK_IDLE||this._element.networkState===this._element.NETWORK_LOADING&&(p.isEdge()||p.isInternetExplorer()||p.isFirefox()&&0===r[0].src.indexOf("blob:")))&&i.asyncSuccess(!0)},delay:50}),a=(this._element.preload=this._preload?"auto":"none",0),d=new y;if(n)for(var c=this._element.getElementsByTagName("SOURCE"),u=function(){++a===r.length&&i.asyncError(!0)},h=0;h<c.length;++h)d.on(c[h],"error",u);else m.iter(r,function(e){var t=document.createElement("source");e.type&&(t.type=e.type),this._element.appendChild(t),d.on(t,"error",function(){++a===r.length&&i.asyncError(!0)}),t.src=e.src},this);i.callback(function(){d.weakDestroy(),s.destroy()},this),i.success(function(){this._setup()},this);try{p.isChrome()||this._element.load()}catch(l){}return i},destroy:function(){(!p.isInternetExplorer()||8<p.internetExplorerVersion())&&(this._element.innerHTML=""),e.destroy.call(this)},_setup:function(){this._domEvents.on(this._element,"playing",this._eventPlaying,this),this._domEvents.on(this._element,"pause",this._eventPaused,this),this._domEvents.on(this._element,"ended",this._eventEnded,this);for(var e=this._element.getElementsByTagName("SOURCE"),t=function(){this._eventError(this.cls.ERROR_NO_PLAYABLE_SOURCE)},i=0;i<e.length;++i)this._domEvents.on(e[i],"error",t,this);p.isSafari()&&(5<p.safariVersion()||p.safariVersion()<9)&&this._element.networkState===this._element.NETWORK_LOADING&&r.eventually(function(){this.destroyed()||this._element.networkState!==this._element.NETWORK_LOADING||0!==this._element.buffered.length||this._eventError(this.cls.ERROR_NO_PLAYABLE_SOURCE)},this,1e4)},buffered:function(){return this._element.buffered.end(0)},play:function(){return e.play.call(this)},pause:function(){this._element.pause()},setPosition:function(e){this._element.currentTime=e},muted:function(){return this._element.muted},setMuted:function(e){this._element.muted=e},volume:function(){return this._element.volume},setVolume:function(e){this._element.volume=e}}})}),e.extend("module:AudioPlayer.AudioPlayerWrapper",["module:AudioPlayer.AudioPlayerWrapper","module:AudioPlayer.Html5AudioPlayerWrapper"],function(e,t){return e.register(t,2),{}}),e.define("module:AudioRecorder.AudioRecorderWrapper",["base:Classes.ConditionalInstance","base:Events.EventsMixin","base:Objs","base:Promise"],function(e,t,i,r,n){return e.extend({scoped:n},[t,function(t){return{constructor:function(e){t.constructor.call(this,e),this._element=this._options.element,this.ready=r.create()},destroy:function(){t.destroy.call(this)},bindMedia:function(){return this._bindMedia()},_bindMedia:function(){},unbindMedia:function(){return this._unbindMedia()},_unbindMedia:function(){},softwareDependencies:function(){return this._softwareDependencies()},_softwareDependencies:function(){},soundLevel:function(){},testSoundLevel:function(e){},getVolumeGain:function(){},setVolumeGain:function(e){},enumerateDevices:function(){},currentDevices:function(){},setCurrentDevices:function(e){},startRecord:function(e){},pauseRecord:function(){},resumeRecord:function(){},stopRecord:function(e){},canPause:function(){return!1},isWebrtcStreaming:function(){return!1},supportsLocalPlayback:function(){return!1},localPlaybackSource:function(){return null},recordDelay:function(e){return 0}}}],{_initializeOptions:function(e){return i.extend({recordVideo:!1,recordAudio:!0},e)}})}),e.define("module:AudioRecorder.WebRTCAudioRecorderWrapper",["module:AudioRecorder.AudioRecorderWrapper","module:WebRTC.RecorderWrapper","module:WebRTC.Support","module:WebRTC.AudioAnalyser","browser:Dom","browser:Info","base:Time","base:Objs","browser:Upload.FileUploader","browser:Upload.MultiUploader","base:Promise"],function(e,i,r,n,o,t,s,a,d,c,u,h){return e.extend({scoped:h},function(t){return{constructor:function(e){t.constructor.call(this,e),"audio"!==this._element.tagName.toLowerCase()&&(this._element=o.changeTag(this._element,"audio")),this._recorder=i.create({video:this._element,recordVideo:!1,recordAudio:this._options.recordAudio,audioBitrate:this._options.audioBitrate,webrtcStreaming:this._options.webrtcStreaming,webrtcStreamingIfNecessary:this._options.webrtcStreamingIfNecessary,localPlaybackRequested:this._options.localPlaybackRequested}),this._recorder.on("bound",function(){this._analyser&&this.testSoundLevel(!0)},this),this._recorder.on("error",function(e,t){this.trigger("error",e,t)},this),this._recorder.on("dataavailable",function(e){this.trigger("dataavailable",e)},this),this.ready.asyncSuccess(!0)},destroy:function(){this._analyser&&this._analyser.weakDestroy(),this._recorder.destroy(),t.destroy.call(this)},recordDelay:function(e){return this._recorder.recordDelay(e)},_bindMedia:function(){return this._recorder.bindMedia()},_unbindMedia:function(){return this._recorder.unbindMedia()},getVolumeGain:function(){return this._recorder.getVolumeGain()},setVolumeGain:function(e){this._recorder.setVolumeGain(e)},soundLevel:function(){return!this._analyser&&this._recorder&&this._recorder.stream()&&(this._analyser=new n(this._recorder.stream())),this._analyser?this._analyser.soundLevel():0},isWebrtcStreaming:function(){return this._recorder.isWebrtcStreaming()},testSoundLevel:function(e){this._analyser&&(this._analyser.weakDestroy(),delete this._analyser),e&&(this._analyser=new n(this._recorder.stream()))},currentDevices:function(){return{audio:this._currentAudio}},enumerateDevices:function(){return r.enumerateMediaSources().success(function(e){this._currentAudio||(this._currentAudio=a.ithKey(e.audio))},this)},setCurrentDevices:function(e){e&&e.audio&&this._recorder.selectMicrophone(e.audio)},canPause:function(){return this._recorder.canPause()},startRecord:function(e){return this.__localPlaybackSource=null,this._recorder.startRecord(e)},pauseRecord:function(){return this._recorder.pauseRecord()},resumeRecord:function(){return this._recorder.resumeRecord()},stopRecord:function(n){var o=u.create();return this._recorder.once("data",function(e,t,i){this.__localPlaybackSource={src:t||e};var r=new c;this._options.simulate||i||n.noUploading||e&&r.addUploader(d.create(a.extend({source:t||e},n.audio))),o.asyncSuccess(r)},this),this._recorder.stopRecord(),o},supportsLocalPlayback:function(){return!!this.__localPlaybackSource.src},localPlaybackSource:function(){return this.__localPlaybackSource},_softwareDependencies:function(){return u.value(!0)}}},{supported:function(e){return!!i.anySupport(e)}})}),e.extend("module:AudioRecorder.AudioRecorderWrapper",["module:AudioRecorder.AudioRecorderWrapper","module:AudioRecorder.WebRTCAudioRecorderWrapper"],function(e,t){return e.register(t,2),{}}),e.define("module:Encoding.WaveEncoder.Support",["base:Promise","base:Scheduling.Helper"],function(l,p){return{dumpInputBuffer:function(e,t,i,r){return{left:new Float32Array(e.getChannelData(0)),right:1<t?new Float32Array(e.getChannelData(1)):null,offset:r||0,endOffset:i}},waveChannelTransform:function(e,t,i,r){var n=l.create(),o=32767*(t||1),s=e.offset,a=e.endOffset,d=e.left,c=e.right,u=new Int16Array((a-s)*(c?2:1)),h=0;return p.schedulable(function(e){for(;0<e;){if(e--,a<=s)return n.asyncSuccess(u),!0;u[h]=d[s]*o,h++,c&&(u[h]=c[s]*o,h++),s++}return!1},100,i,r),n},generateHeader:function(e,t,i,r){r=r||new ArrayBuffer(44);var n=new DataView(r);return n.writeUTFBytes=function(e,t){for(var i=0;i<t.length;i++)this.setUint8(e+i,t.charCodeAt(i))},n.writeUTFBytes(0,"RIFF"),n.setUint32(4,44+e,!0),n.writeUTFBytes(8,"WAVE"),n.writeUTFBytes(12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,t,!0),n.setUint32(24,i,!0),n.setUint32(28,4*i,!0),n.setUint16(32,2*t,!0),n.setUint16(34,16,!0),n.writeUTFBytes(36,"data"),n.setUint32(40,e,!0),r}}}),e.define("module:Encoding.WebmEncoder.Support",["base:Promise","base:Scheduling.Helper","base:Types"],function(e,t,i){return{parseWebP:function(e){for(var t=e.RIFF[0].WEBP[0],i=t.indexOf("\x9d\x01*"),r=0,n=[];r<4;r++)n[r]=t.charCodeAt(i+3+r);return{width:16383&(n[1]<<8|n[0]),height:16383&(n[3]<<8|n[2]),data:t,riff:e}},parseRIFF:function(e){for(var t=0,i={},r=function(e){e=e.charCodeAt(0).toString(2);return new Array(8-e.length+1).join("0")+e};t<e.length;){var n=e.substr(t,4),o=parseInt(e.substr(t+4,4).split("").map(r).join(""),2),s=e.substr(t+4+4,o);t+=8+o,i[n]=i[n]||[],"RIFF"==n||"LIST"==n?i[n].push(this.parseRIFF(s)):i[n].push(s)}return i},isBlankFrame:function(e,t,i,r){if("function"==typeof Array.prototype.some)return!e.getContext("2d").getImageData(0,0,e.width,e.height).data.some(function(e){return 0!==e});for(var n=document.createElement("canvas"),n=(n.width=e.width,n.height=e.height,n.getContext("2d")),o=0,s=0,a=0,d=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),c=i&&0<=i&&i<=1?i:0,i=r&&0<=r&&r<=1?r:0,r=new Image,u=(r.src=t.image,n.drawImage(r,0,0,e.width,e.height),n.getImageData(0,0,e.width,e.height)),h=0,l=u.data.length,t=u.data.length/4,p=0;p<l;p+=4){var _=u.data[p],m=u.data[p+1],f=u.data[p+2];Math.sqrt(Math.pow(_-o,2)+Math.pow(m-s,2)+Math.pow(f-a,2))<=d*c&&h++}return t-h<=t*i},makeSimpleBlock:function(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),127<e.trackNum)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame},generateEBMLHeader:function(e,t,i){return[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join(""),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:25541},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t,id:176},{data:i,id:186}]}]}]}]}]},__numToBuffer:function(e){for(var t=[];0<e;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())},__strToBuffer:function(e){return new Uint8Array(e.split("").map(function(e){return e.charCodeAt(0)}))},__bitsToBuffer:function(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var i=0;i<e.length;i+=8)t.push(parseInt(e.substr(i,8),2));return new Uint8Array(t)},serializeEBML:function(e){var n;return i.is_array(e)?(n=[],e.forEach(function(e){var t=e.data,i=typeof t,i=("object"==i?t=this.serializeEBML(t):"number"==i?t=this.__bitsToBuffer(t.toString(2)):"string"==i&&(t=this.__strToBuffer(t)),t.size||t.byteLength||t.length),r=Math.ceil(Math.ceil(Math.log(i)/Math.log(2))/8),i=i.toString(2),i=new Array(7*r+7+1-i.length).join("0")+i,r=new Array(r).join("0")+"1"+i;n.push(this.__numToBuffer(e.id)),n.push(this.__bitsToBuffer(r)),n.push(t)},this),new Blob(n,{type:"video/webm"})):e},makeTimecodeDataBlock:function(e,t){return{data:this.makeSimpleBlock({discardable:0,frame:e.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(t)}),id:163}},makeCluster:function(e,t){return e.unshift({data:t,id:231}),{id:524531317,data:e}}}}),e.define("module:ImageRecorder.ImageRecorderWrapper",["base:Classes.ConditionalInstance","base:Events.EventsMixin","base:Objs","base:Promise"],function(e,t,i,r,n){return e.extend({scoped:n},[t,function(t){return{constructor:function(e){t.constructor.call(this,e),this._element=this._options.element,this.ready=r.create()},destroy:function(){t.destroy.call(this)},bindMedia:function(){return this._bindMedia()},_bindMedia:function(){},unbindMedia:function(){return this._unbindMedia()},_unbindMedia:function(){},softwareDependencies:function(){return this._softwareDependencies()},_softwareDependencies:function(){},cameraWidth:function(){return this._options.recordingWidth},cameraHeight:function(){return this._options.recordingHeight},lightLevel:function(){},blankLevel:function(){},deltaCoefficient:function(){},enumerateDevices:function(){},currentDevices:function(){},setCurrentDevices:function(e){},setCameraFace:function(e){},getCameraFacingMode:function(){},createSnapshot:function(){},removeSnapshot:function(e){},createSnapshotDisplay:function(e,t,i,r,n,o){},updateSnapshotDisplay:function(e,t,i,r,n,o){},removeSnapshotDisplay:function(e){},createSnapshotUploader:function(e,t,i){},snapshotToLocalPoster:function(e){return null}}}],{_initializeOptions:function(e){return i.extend({recordingWidth:640,recordingHeight:480},e)}})}),e.define("module:ImageRecorder.WebRTCImageRecorderWrapper",["module:ImageRecorder.ImageRecorderWrapper","module:WebRTC.RecorderWrapper","module:WebRTC.Support","browser:Dom","browser:Info","base:Time","base:Objs","browser:Upload.FileUploader","browser:Upload.MultiUploader","base:Promise"],function(e,i,d,c,r,n,o,s,t,a,u){return e.extend({scoped:u},function(t){return{constructor:function(e){t.constructor.call(this,e),"video"!==this._element.tagName.toLowerCase()&&(this._element=c.changeTag(this._element,"video")),this._recorder=i.create({video:this._element,flip:!!this._options.flip,recordVideo:!0,recordAudio:!1,recordResolution:{width:this._options.recordingWidth,height:this._options.recordingHeight},videoBitrate:this._options.videoBitrate,screen:this._options.screen}),this._recorder.on("error",function(e,t){this.trigger("error",e,t)},this),this.ready.asyncSuccess(!0)},destroy:function(){this._recorder.destroy(),t.destroy.call(this)},_bindMedia:function(){return this._recorder.bindMedia()},_unbindMedia:function(){return this._recorder.unbindMedia()},lightLevel:function(){return this._recorder.lightLevel()},blankLevel:function(){return this._recorder.blankLevel()},deltaCoefficient:function(){return this._recorder.deltaCoefficient()},currentDevices:function(){return{video:this._currentVideo}},enumerateDevices:function(){return d.enumerateMediaSources().success(function(e){this._currentVideo||(this._currentVideo=o.ithKey(e.video))},this)},setCurrentDevices:function(e){e&&e.video&&this._recorder.selectCamera(e.video)},setCameraFace:function(e){r.isMobile()&&this._recorder.selectCameraFace(e)},getCameraFacingMode:function(){if(r.isMobile())return this._recorder.getCameraFacingMode()},createSnapshot:function(e){return this._recorder.createSnapshot(e)},removeSnapshot:function(e){},createSnapshotDisplay:function(e,t,i,r,n,o){var s=d.globals().URL.createObjectURL(t),a=document.createElement("img");return a.style.position="absolute",this.updateSnapshotDisplay(t,a,i,r,n,o),a.src=s,c.elementPrependChild(e,a),a},updateSnapshotDisplay:function(e,t,i,r,n,o){t.style.left=i+"px",t.style.top=r+"px",t.style.width=n+"px",t.style.height=o+"px"},removeSnapshotDisplay:function(e){e.remove()},createSnapshotUploader:function(e,t,i){return s.create(o.extend({source:e},i))},snapshotToLocalPoster:function(e){return e},_softwareDependencies:function(){var e,t,i;return!this._options.screen||d.globals().supportedConstraints.mediaSource?a.value(!0):(e=d.chromeExtensionExtract(this._options.screen),t=[{title:"Screen Recorder Extension",execute:function(){window.open(e.extensionInstallLink)}}],i=n.now(),d.chromeExtensionMessage(e.extensionId,{type:"ping",data:i}).mapError(function(){return t}).mapSuccess(function(e){return!(!e||"success"!==e.type||e.data!==i)||a.error(t)}))}}},{supported:function(e){return!(!i.anySupport(e)||e.screen&&!(d.globals().supportedConstraints.mediaSource&&r.isFirefox()&&55<r.firefoxVersion())&&(!r.isChrome()||!e.screen.chromeExtensionId)&&(!r.isOpera()||!e.screen.operaExtensionId))}})}),e.extend("module:ImageRecorder.ImageRecorderWrapper",["module:ImageRecorder.ImageRecorderWrapper","module:ImageRecorder.WebRTCImageRecorderWrapper"],function(e,t){return e.register(t,2),{}}),e.define("module:Player.Broadcasting",["base:Class","browser:Loader","browser:Events"],function(e,i,r,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.apply(this),this.player=e.player,this.googleCast={},this.airplay={},this.options=e.commonOptions,this.googleCast.initialOptions=e.castOptions,this.airplayOptions=e.airplayOptions,this.player.on("pause-google-cast",function(){this._googleCastRemotePause()},this),this.player.on("play-google-cast",function(){this._googleCastRemotePlay()},this),this.player.on("google-cast-seeking",function(e){this._seekToGoogleCast(e)},this),this.player.on("change-google-cast-volume",function(e){e=Math.min(1,e),this._changeGoogleCastVolume(e)},this)},attachAirplayEvent:function(e){this._airplayEvent=this.auto_destroy(new r),this._airplayEvent.on(e,"webkitplaybacktargetavailabilitychanged",function(e){return"available"===e.availability&&(this.player._broadcastingState.airplayConnected=!0)},this)},attachGoggleCast:function(){var t=this;window.__onGCastApiAvailable=function(e){e&&t._initializeCastApi()},i.loadScript("https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",function(){})},_initializeCastApi:function(){var t=this,e=(t.player.trigger("cast-available",!0),this.googleCast.initialOptions),i={},r=[chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,"41A5ADFD","8AA2B3F9","DE815B4F"],n=[chrome.cast.AutoJoinPolicy.PAGE_SCOPED,chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED,chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED],n=(i.autoJoinPolicy=n[1],i.receiverApplicationId=this.options.chromecastReceiverAppId||r[2],i.androidReceiverCompatible=!0,cast.framework.CastContext.getInstance()),o=(n.setOptions(i),new cast.framework.RemotePlayer),s=(o.title=this.options.title,o.canControlVolume=e.canControlVolume,o.canPause=e.canPause,o.canSeek=e.canSeek,o.duration=e.duration,o.imageUrl=e.imageUrl,o.isConnected=e.isConnected,o.isMuted=e.isMuted,o.isPaused=e.isPaused,o.title=this.options.title,o.displayName=e.displayName,new cast.framework.RemotePlayerController(o)),a=cast.framework.CastState,d=cast.framework.CastState.CONNECTING,c=cast.framework.CastState.NO_DEVICES_AVAILABLE,r=cast.framework.CastContextEventType.CAST_STATE_CHANGED;n.addEventListener(r,function(e){e=e.castState;t.player.trigger("cast-state-changed",e,a),e!==c&&(o.displayStatus=e===d?"Please wait connecting":"")}),s.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,function(){cast&&cast.framework&&(o.isConnected?t._setupCastRemotePlayer(o,s):t._destroyCastRemotePlayer(o,s))})},_setupCastRemotePlayer:function(i,e){var r=this,n=this.player,t=(this.castOptions,n._sources),o=n._element.currentSrc,t=t[0].type,s=cast.framework.CastContext.getInstance().getCurrentSession(),o=new chrome.cast.media.MediaInfo(o,t),t=(o.metadata=new chrome.cast.media.GenericMediaMetadata,o.metadata.metadataType=chrome.cast.media.MetadataType.GENERIC,o.metadata.title=this.options.title,o.metadata.images=[{url:this.options.poster}],new chrome.cast.media.LoadRequest(o));this.googleCast.castRemotePlayer=i,this.googleCast.castRemotePlayerController=e,this.googleCast.castMediaInfo=o,this.googleCast.castSession=s,e.addEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,function(){var e;s&&(e=s.getMediaSession())&&n.trigger("cast-paused","PAUSED"===e.playerState)}),s.loadMedia(t).then(function(){n._broadcastingState.googleCastConnected=!0,n.trigger("cast-loaded",i,e),e.addEventListener(cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED,function(){n.trigger("cast-paused",i.isPaused)}),e.addEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,function(){var e=r._getGoogleCastCurrentMediaTime(i),t=r._getGoogleCastMediaDuration(i);n.trigger("cast-time-changed",e,t)})},function(e){console.warn("Remote media load error : "+r._googleCastPlayerErrorMessages(e))})},_destroyCastRemotePlayer:function(e,t){var i=this.player,r=this._getGoogleCastCurrentMediaTime(e);t.removeEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED),t.removeEventListener(cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED),t.removeEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED),e.savedPlayerState&&!e.isConnected&&(r=e.savedPlayerState.currentTime),i._broadcastingState.googleCastConnected&&0<r&&i.trigger("proceed-when-ending-googlecast",r,e.isPaused),this.player._broadcastingState.googleCastConnected=!1},_getGoogleCastRemotePlayer:function(){if(this.player._broadcastingState.googleCastConnected)return this.googleCast.castRemotePlayer},_getGoogleCastRemotePlayerController:function(){if(this.player._broadcastingState.googleCastConnected)return this.googleCast.castRemotePlayerController},_getGoogleCastMediaInfo:function(){if(this.player._broadcastingState.googleCastConnected)return this.googleCast.castMediaInfo},_getGoogleCastCurrentSession:function(){if(this.player._broadcastingState.googleCastConnected)return this.googleCast.castSession},_getGoogleCastCurrentMediaTime:function(e){if(this.player._broadcastingState.googleCastConnected)return Math.floor(10*e.currentTime)/10},_getGoogleCastMediaDuration:function(e){if(this.player._broadcastingState.googleCastConnected)return e.duration},_googleCastRemotePlay:function(){var e,t;return!!this.player._broadcastingState.googleCastConnected&&(e=this._getGoogleCastRemotePlayer(),t=this._getGoogleCastRemotePlayerController(),"PAUSED"===e.playerState&&t.playOrPause(),e)},_googleCastRemotePause:function(){var e,t;return!!this.player._broadcastingState.googleCastConnected&&(e=this._getGoogleCastRemotePlayer(),t=this._getGoogleCastRemotePlayerController(),"PLAYING"===e.playerState&&t.playOrPause(),e)},_seekToGoogleCast:function(e){var t=this._getGoogleCastRemotePlayer(),i=this._getGoogleCastRemotePlayerController();t.currentTime=e,i.seek()},_changeGoogleCastVolume:function(e){var t=this._getGoogleCastRemotePlayerController();this._getGoogleCastRemotePlayer().volumeLevel=e,t.setVolumeLevel()},_googleCastPlayerErrorMessages:function(e){switch(e.code){case chrome.cast.ErrorCode.API_NOT_INITIALIZED:return"The API is not initialized."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.CANCEL:return"The operation was canceled by the user"+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.CHANNEL_ERROR:return"A channel to the receiver is not available."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.EXTENSION_MISSING:return"The Cast extension is not available."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.INVALID_PARAMETER:return"The parameters to the operation were not valid."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.RECEIVER_UNAVAILABLE:return"No receiver was compatible with the session request."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.SESSION_ERROR:return"A session could not be created, or a session was invalid."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.TIMEOUT:return"The operation timed out."+(e.description?" :"+e.description:"")}},lookForAirplayDevices:function(e){return e.webkitShowPlaybackTargetPicker()}}})}),e.define("module:HlsSupportMixin",["base:Promise","base:Async","browser:Loader"],function(t,i,r){var n=!1;return{_hlsObj:function(){return window.Hls},_hlsIsSupported:function(){return!!this._hlsObj()&&this._hlsObj().isSupported()},_lazyLoadHls:function(){var e;return n?t.value(this._hlsIsSupported()):(e=t.create(),r.loadScript("https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.1.5/hls.light.min.js",function(){n=!0,i.eventually(function(){e.asyncSuccess(this._hlsIsSupported())},this)},this),e)},_loadHls:function(e){var r=t.create(),n=this._hlsObj();return this._hls=new n,this._hls.on(n.Events.MEDIA_ATTACHED,function(){this._hls.loadSource(e.src),this._hls.on(n.Events.MANIFEST_PARSED,function(e,t){this._qualityOptions=t.levels.map(function(e,t){return{id:t,label:e.width+"x"+e.height+" ("+Math.round(e.bitrate/1024)+" kbps)"}}),this._currentQuality=this._qualityOptions[this._hls.startLevel],this._hls.on(n.Events.LEVEL_SWITCHED,function(e,t){this._currentQuality=this._qualityOptions[t.level],this.trigger("qualityswitched",this._qualityOptions[t.level])}.bind(this)),this.on("setsourcequality",function(e){this._hls.currentLevel=e}),r.asyncSuccess(!0)}.bind(this))}.bind(this)),this._hls.on(n.Events.ERROR,function(e,t){var i;if(t.fatal)switch(t.type){case n.ErrorTypes.NETWORK_ERROR:this._hls.startLoad(),i="HLS Network Error";break;case n.ErrorTypes.MEDIA_ERROR:this._hls.recoverMediaError(),i="HLS Media Error";break;default:this._hls.destroy(),i="HLS Fatal Error"}r.asyncError(i)}.bind(this)),this._hls.attachMedia(this._element),r}}}),e.define("module:Player.Support",["base:Promise","base:Objs"],function(c,u){return{resolutionToLabel:function(e,t){return t<300?"SD":t<400?"360p":t<500?"480p":"HD"},elementFileInfo:function(e,t,i,r){try{var n=document.createElement(e),o=(u.iter(i,function(e,t){n[t]=e}),c.create()),s=!1,a=setTimeout(function(){s=!0,n.error!=undefined?o.asyncError(n.error):o.asyncError("Timeout")},1e3);return n[t]=function(){s||(clearTimeout(a),o.asyncSuccess(n))},n.src=(window.URL||window.webkitURL).createObjectURL(r),o}catch(d){return c.error(d)}},videoFileInfo:function(e){return this.elementFileInfo("video","onloadeddata",{volume:0,muted:!0,preload:!0},e).mapSuccess(function(e){return{width:e.videoWidth,height:e.videoHeight,duration:e.duration}}).mapError(function(e){return e})},audioFileInfo:function(e){return this.elementFileInfo("audio","onloadeddata",{volume:0,muted:!0,preload:!0},e).mapSuccess(function(e){return{duration:e.duration}})},imageFileInfo:function(e){return this.elementFileInfo("img","onload",{},e).mapSuccess(function(e){return{width:e.width,height:e.height}})}}}),e.define("module:Player.VideoPlayerWrapper",["base:Classes.OptimisticConditionalInstance","base:Events.EventsMixin","base:MediaTypes","base:Types","base:Objs","base:Strings","browser:Events"],function(e,t,n,o,s,a,d,i){return e.extend({scoped:i},[t,function(r){return{constructor:function(e,t){r.constructor.call(this),e=s.extend(s.clone(e||{},1),t),this._poster=e.poster||null;var t=e.source||e.sources||[],i=(o.is_string(t)?t=t.split(" "):o.is_array(t)||(t=[t]),this._onlyAudio=!1,"undefined"!=typeof e.onlyaudio&&(this._onlyAudio=e.onlyaudio),[]);s.iter(t,function(e){o.is_string(e)?e={src:e.trim()}:"undefined"!=typeof Blob&&e instanceof Blob&&(e={src:e}),e.ext&&!e.type&&(e.type=n.getType(e.ext)),!e.ext&&e.type&&(e.ext=n.getExtension(e.type)),e.ext||e.type||!o.is_string(e.src)||0<=(t=a.splitFirst(e.src,"?").head).indexOf(".")&&(e.ext=a.last_after(t,"."),e.type=n.getType(e.ext)),e.ext&&(e.ext=e.ext.toLowerCase()),e.type&&(e.type=e.type.toLowerCase());var t=null;"undefined"!=typeof e.audiosrc&&(t=e.audiosrc),"undefined"!=typeof Blob&&e.src instanceof Blob&&(e.src=this._onlyAudio&&t?(window.URL||window.webkitURL).createObjectURL(t):(window.URL||window.webkitURL).createObjectURL(e.src)),"undefined"!=typeof Blob&&e.audiosrc instanceof Blob&&(e.audiosrc=(window.URL||window.webkitURL).createObjectURL(e.audiosrc)),i.push(e)},this),this._sources=i,this._element=e.element,this._preload=e.preload||!1,this._reloadonplay=e.reloadonplay||!1,this._options=e,this._loop=e.loop||!1,this._fullscreenedElement=e.fullscreenedElement,this._preloadMetadata=e.loadmetadata||!1,this._loaded=!1,this._postererror=!1,this._error=0,this._domEvents=new d,this._broadcastingState={googleCastConnected:!1,airplayConnected:!1}},destroy:function(){this._domEvents.destroy(),r.destroy.call(this)},poster:function(){return this._poster},sources:function(){return this._sources},loaded:function(){return this._loaded},postererror:function(){return this._postererror},buffered:function(){},_eventLoaded:function(e){this._loaded=!0,this.trigger("loaded")},_eventLoadedMetaData:function(e){this._hasMetadata=!0,this.trigger("loadedmetadata",e)},_eventPosterLoaded:function(e){this.trigger("posterloaded",e)},_eventPlaying:function(){this._loaded||this._eventLoaded(),this.trigger("playing")},_eventPaused:function(){this.duration()&&this.duration()===this.position()||this.trigger("paused")},_eventEnded:function(){this.trigger("ended")},_eventError:function(e){this._error=e,this.trigger("error",e)},_eventPosterError:function(){this._postererror=!0,this.trigger("postererror")},supportsFullscreen:function(){return!1},duration:function(){return this._element.duration},position:function(){return this._element.currentTime},enterFullscreen:function(){},exitFullscreen:function(){},isFullscreen:function(){return!1},supportsPIP:function(){return!1},enterPIPMode:function(){},exitPIPMode:function(){},isInPIPMode:function(){return!1},error:function(){return this._error},play:function(){this._reloadonplay&&(this._hls?this._hls.startLoad():this._element.load()),this._reloadonplay=!1;try{var e=this._element.play();e["catch"]&&e["catch"](function(){})}catch(t){}},pause:function(){this._element.pause()},setPosition:function(e){this._element.currentTime=e},muted:function(){return this._element.muted},setMuted:function(e){this._element.muted=e},volume:function(){return this._element.volume},setVolume:function(e){this._element.volume=e},videoWidth:function(){},videoHeight:function(){},createSnapshotPromise:function(e){}}}],{ERROR_NO_PLAYABLE_SOURCE:1})}),e.define("module:Player.Html5VideoPlayerWrapper",["module:HlsSupportMixin","module:Player.VideoPlayerWrapper","browser:Info","base:Promise","base:Objs","base:Timers.Timer","base:Strings","base:Async","browser:Dom","browser:Events"],function(e,t,_,m,f,g,v,s,y,b,i){return t.extend({scoped:i},[e,function(e){return{_initialize:function(){if(this._options.nohtml5)return m.error(!0);if(this._sources.length<1)return m.error(!0);if(_.isInternetExplorer()&&_.internetExplorerVersion()<9)return m.error(!0);var t,i=m.create(),r=(this._element.innerHTML="",this.sources()),e=0===r[0].src.indexOf("blob:")&&r[0].src,n=_.isInternetExplorer()&&9==_.internetExplorerVersion()||_.isWindowsPhone(),o=("video"!==this._element.tagName.toLowerCase()?(this._element=y.changeTag(this._element,"video"),this._transitionals.element=this._element):n&&(t=v.splitLast(this._element.outerHTML,"</video>").head,f.iter(r,function(e){t+="<source"+(e.type?" type='"+e.type+"'":"")+" src='"+e.src+"' />"}),t+="</video>",a=y.elementByTemplate(t),y.elementInsertAfter(a,this._element),this._element.parentNode.removeChild(this._element),this._element=a,this._transitionals.element=this._element),_.isSafari()&&_.safariVersion()<6&&(this._element.src=r[0].src,this._preload=!0),this._domEvents.on(this._element,"loadevent",function(){this._element.networkState===this._element.NETWORK_NO_SOURCE?i.asyncError(!0):i.asyncSuccess(!0)},this),10),s=new g({context:this,fire:function(){this._element.networkState===this._element.NETWORK_NO_SOURCE?--o<=0&&i.asyncError(!0):(this._element.networkState===this._element.NETWORK_IDLE||this._element.networkState===this._element.NETWORK_LOADING&&(_.isEdge()||_.isInternetExplorer()||_.isFirefox()&&e))&&i.asyncSuccess(!0)},delay:50}),a=this._preloadMetadata?"metadata":"none",d=(this._element.preload=this._preload?"auto":a,0),c=(this._audioElement=null,new b);if(e)this._element.src=e;else if(n)for(var u=this._element.getElementsByTagName("SOURCE"),h=function(){++d===r.length&&i.asyncError(!0)},l=0;l<u.length;++l)c.on(u[l],"error",h);else f.iter(r,function(t){var e=document.createElement("source");"m3u8"===t.ext?this._lazyLoadHls().success(function(e){e&&this._loadHls(t).forwardSuccess(i)},this):(t.type&&(e.type=t.type),this._element.appendChild(e),c.on(e,"error",function(){++d===r.length&&i.asyncError(!0)}),e.src=t.src,t.audiosrc&&(this._audioElement||(this._audioElement=document.createElement("audio"),y.elementInsertAfter(this._audioElement,this._element)),e=document.createElement("source"),t.type&&(e.type=t.type),this._audioElement.appendChild(e),e.src=t.audiosrc))},this);this.poster()&&(this._element.poster=this.posterURL()),i.callback(function(){c.weakDestroy(),s.destroy()},this),i.success(function(){this._setup()},this);try{_.isChrome()||this._element.load()}catch(p){}return i},posterURL:function(){var e=this.poster();return e&&"undefined"!=typeof Blob&&e instanceof Blob?(window.URL||window.webkitURL).createObjectURL(e):e},destroy:function(){this._hls&&this._hls.destroy(),this._audioElement&&this._audioElement.remove(),this.supportsFullscreen()&&this.__fullscreenListener&&y.elementOffFullscreenChange(this._element,this.__fullscreenListener),this.supportsPIP()&&this.__pipListener&&y.videoRemovePIPChangeListeners(this._element,this.__pipListener),(!_.isInternetExplorer()||8<_.internetExplorerVersion())&&(this._element.innerHTML=""),e.destroy.call(this)},_eventEnded:function(){this._loop&&this.play(),e._eventEnded.call(this)},_setup:function(){this._loaded=!1,this._domEvents.on(this._element,"canplay",this._eventLoaded,this),this._domEvents.on(this._element,"loadedmetadata",this._eventLoadedMetaData,this),this._domEvents.on(this._element,"playing",this._eventPlaying,this),this._domEvents.on(this._element,"pause",this._eventPaused,this),this._domEvents.on(this._element,"ended",this._eventEnded,this);for(var e,t,i=this,r=this._element.getElementsByTagName("SOURCE"),n=function(){this._eventError(this.cls.ERROR_NO_PLAYABLE_SOURCE)},o=0;o<r.length;++o)this._domEvents.on(r[o],"error",n,this);this.poster()&&((e=new Image).onerror=function(){delete i._element.poster,delete i._element.preload,i._eventPosterError()},e.src=this.posterURL(),e.onload=function(){i.__imageWidth=e.width,i.__imageHeight=e.height,i._eventPosterLoaded(this)}),_.isSafari()&&(5<_.safariVersion()||_.safariVersion()<9)&&this._element.networkState===this._element.NETWORK_LOADING&&s.eventually(function(){this.destroyed()||this._element.networkState!==this._element.NETWORK_LOADING||0!==this._element.buffered.length||this._eventError(this.cls.ERROR_NO_PLAYABLE_SOURCE)},this,1e4),this.supportsFullscreen()&&(this.__videoClassBackup="",t=this._fullscreenedElement||this._element,this.__fullscreenListener=y.elementOnFullscreenChange(t,function(e,t){this.trigger("fullscreen-change",t),t?(this.__videoClassBackup=this._element.className,this._element.className=""):(this._element.className=this.__videoClassBackup,this.__videoClassBackup="")},this)),this.supportsPIP()&&"pictureInPictureElement"in document&&(this.__pipListener=y.videoAddPIPChangeListeners(this._element,function(e,t){this.trigger("pip-mode-change",e,t)},this))},buffered:function(){return this._element.buffered.end(0)},_fullscreenElement:function(e){return _.isChromiumBased()&&!_.isMobile()?e||this._element.parentNode:_.isFirefox()?e||this._element.parentElement:e||this._element},supportsFullscreen:function(e){return y.elementSupportsFullscreen(this._fullscreenElement(e))},enterFullscreen:function(e){y.elementEnterFullscreen(this._fullscreenElement(e))},exitFullscreen:function(){y.documentExitFullscreen()},isFullscreen:function(e){return y.elementIsFullscreen(this._fullscreenElement(e))},supportsPIP:function(){return y.browserSupportsPIP(this._element)},enterPIPMode:function(e){y.videoElementEnterPIPMode(this._element)},exitPIPMode:function(){y.videoElementExitPIPMode(this._element)},isInPIPMode:function(){return y.videoIsInPIPMode(this._element)},videoWidth:function(){return this._element.width||this.__imageWidth||NaN},videoHeight:function(){return this._element.height||this.__imageHeight||NaN},play:function(){e.play.call(this),this._audioElement&&(this._reloadonplay&&this._audioElement.load(),this._audioElement.play())},pause:function(){this._element.pause(),this._audioElement&&this._audioElement.pause()},setPosition:function(e){this._element.currentTime=e,this._audioElement&&(this._audioElement.currentTime=e)},setSpeed:function(e){e<.5&&4<e?console.warn("Maximum allowed speed range is from 0.5 to 4.0"):(this._element.playbackRate=e,this._audioElement&&(this._audioElement.playbackRate=e))},muted:function(){return(this._audioElement||this._element).muted},setMuted:function(e){(this._audioElement||this._element).muted=e},volume:function(){return(this._audioElement||this._element).volume},setVolume:function(e){(this._audioElement||this._element).volume=e},createSnapshotPromise:function(e){var t,i=this._element,r=document.createElement("canvas"),n=r.getContext("2d");return r.width=i.videoWidth,r.height=i.videoHeight,n.drawImage(i,0,0,r.width,r.height),n=(i=r).getContext("2d"),new Uint32Array(n.getImageData(0,0,i.width,i.height).data.buffer).some(function(e){return 0!==e})?(t=m.create(),r.toBlob(function(e){t.asyncSuccess(e)},e),t):m.error(!0)}}}])}),e.extend("module:Player.VideoPlayerWrapper",["module:Player.VideoPlayerWrapper","module:Player.Html5VideoPlayerWrapper"],function(e,t){return e.register(t,2),{}}),e.define("module:Recorder.Support",["module:WebRTC.Support","browser:Upload.FileUploader","browser:Upload.CustomUploader","browser:Dom","browser:Events","browser:Info","base:Promise","base:Objs"],function(d,r,e,c,l,u,p,n){return{createSnapshot:function(e,t,i,r,n,o,s,a){e=this._createSnapshot(e,t,i,r,n,o,s,a);return e&&d.dataURItoBlob(e)},createSnapshotFromSource:function(e,t,i,r,n,o,s,a,d){var c=p.create(),u=document.createElement("video"),h=(u.src=e,new l);return h.on(u,"loadedmetadata",function(){u.currentTime=i||0}),h.on(u,"seeked",function(){window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){var e=this.createSnapshot(t,u,r,n,o,s,a,d);e?c.asyncSuccess(e):c.asyncError("Could not capture snapshot")}.bind(this))}.bind(this)),h.destroy()},this),h.on(u,"error",function(){c.asyncError("Could not load video to capture snapshot"),h.destroy()}),u.load(),c},_createSnapshot:function(e,t,i,r,n,o,s,a){n=n||t.videoWidth||t.clientWidth,r=r||t.videoHeight||t.clientHeight;if(!n||!r)return null;o=o||0,s=s||0,a=a||1,i=i||!1;var d=document.createElement("canvas");d.width=n,d.height=r;n=1<d.width/d.height?"landscape":"portrait",r=u.isSafari()||u.isMobile()&&u.isiOS(),n="portrait"==n&&i&&(u.isFirefox()||r),i=d.getContext("2d"),n&&1!==this.__detectVerticalSquash(t,d.width,d.height)?this.__rotateToPortrait(t,d,i):i.drawImage(t,o,s,d.width,d.height),r=d.toDataURL(e,a);return this.__isCanvasBlank(d)?null:r},__rotateToPortrait:function(e,t,i){var r=Math.abs(t.height-t.width),n=t.width>t.height?t.width:t.height;t.height=t.width=n,i.drawImage(e,0,0,t.height,t.width),i.clearRect(0,0,t.width,t.height),i.save(),t.width-=r,i.translate(t.width/2,t.height/2),i.rotate(Math.PI/180*90),u.isFirefox()?i.drawImage(e,-t.height/2,-t.width/2,t.height,t.width):i.drawImage(e,-t.height/2,-t.width/2,t.height,t.width+r),i.restore()},__isCanvasBlank:function(e){var t=e.getContext("2d");return!!(t&&e.width<=0&&e.height<=0)||!t.getImageData(0,0,e.width,e.height).data.some(function(e){return 0!==e})},__detectVerticalSquash:function(e,t,i){t||e.naturalWidth||e.width;for(var t=i||e.naturalHeight||e.height,i=document.createElement("canvas"),i=(i.width=1,i.height=t,i.getContext("2d")),r=(i.drawImage(e,0,0),i.getImageData(0,0,1,t).data),n=0,o=t,s=t;n<s;)0===r[4*(s-1)+3]?o=s:n=s,s=o+n>>1;e=s/t;return 0==e?1:e},removeSnapshot:function(e){},removeSnapshotDisplay:function(e){e.remove()},createSnapshotDisplay:function(e,t,i,r,n,o){var s=d.globals().URL.createObjectURL(t),a=document.createElement("img");return a.style.position="absolute",this.updateSnapshotDisplay(t,a,i,r,n,o),a.src=s,"video"===e.tagName.toLowerCase()?c.elementInsertAfter(a,e):c.elementPrependChild(e,a),a},snapshotMetaData:function(e){var n=p.create(),e=d.globals().URL.createObjectURL(e),o=new Image;return o.src=e,o.onload=function(e){var t=o.naturalHeight||o.height,i=o.naturalWidth||o.width,r=+(i/t).toFixed(2);n.asyncSuccess({width:i,height:t,orientation:1<r?"landscape":"portrait",ratio:r})},n},updateSnapshotDisplay:function(e,t,i,r,n,o){t.style.left=i+"px",t.style.top=r+"px",t.style.width=n+"px",t.style.height=o+"px"},createSnapshotUploader:function(e,t,i){return r.create(n.extend({source:e},i))}}}),e.define("module:Recorder.PixelSampleMixin",[],function(){return{lightLevel:function(e){var r=0;return this._pixelSample(e=e||100,function(e,t,i){r+=e+t+i}),r/(3*e)},blankLevel:function(e){var r=0;return this._pixelSample(e=e||100,function(e,t,i){r+=Math.pow(e,2)+Math.pow(t,2)+Math.pow(i,2)}),Math.sqrt(r/(3*e))},_materializePixelSample:function(e){var r=[];return this._pixelSample(e,function(e,t,i){r.push([e,t,i])}),r},deltaCoefficient:function(e){var t=this._materializePixelSample(e=e||100);if(!this.__deltaSample)return this.__deltaSample=t,null;for(var i=0,r=0;r<t.length;++r)for(var n=0;n<3;++n)i+=Math.pow(t[r][n]-this.__deltaSample[r][n],2);return this.__deltaSample=t,Math.sqrt(i/(3*e))}}}),e.define("module:Recorder.VideoRecorderWrapper",["base:Classes.ConditionalInstance","base:Events.EventsMixin","base:Objs","base:Promise"],function(e,t,i,r,n){return e.extend({scoped:n},[t,function(t){return{constructor:function(e){t.constructor.call(this,e),this._element=this._options.element,this.ready=r.create()},destroy:function(){t.destroy.call(this)},bindMedia:function(){return this._bindMedia()},_bindMedia:function(){},unbindMedia:function(){return this._unbindMedia()},_unbindMedia:function(){},softwareDependencies:function(){return this._softwareDependencies()},_softwareDependencies:function(){},cameraWidth:function(){return this._options.recordingWidth},cameraHeight:function(){return this._options.recordingHeight},lightLevel:function(){},soundLevel:function(){},testSoundLevel:function(e){},blankLevel:function(){},deltaCoefficient:function(){},getVolumeGain:function(){},setVolumeGain:function(e){},enumerateDevices:function(){},currentDevices:function(){},setCurrentDevices:function(e){},setCameraFace:function(e){},getCameraFacingMode:function(){},addMultiStream:function(e,t){},updateMultiStreamPosition:function(e,t,i,r){},reverseCameraScreens:function(){},createSnapshot:function(){},removeSnapshot:function(e){},createSnapshotDisplay:function(e,t,i,r,n,o){},updateSnapshotDisplay:function(e,t,i,r,n,o){},removeSnapshotDisplay:function(e){},createSnapshotUploader:function(e,t,i){},startRecord:function(e){},pauseRecord:function(){},resumeRecord:function(){},stopRecord:function(e){},errorHandler:function(e){},isWebrtcStreaming:function(){return!1},canPause:function(){return!1},supportsLocalPlayback:function(){return!1},supportsCameraFace:function(){return!1},snapshotToLocalPoster:function(e){return null},localPlaybackSource:function(){return null},averageFrameRate:function(){return null},recordDelay:function(e){return 0}}}],{_initializeOptions:function(e){return i.extend({recordingWidth:640,recordingHeight:480,recordVideo:!0,recordAudio:!0},e)}})}),e.define("module:Recorder.WebRTCVideoRecorderWrapper",["module:Recorder.VideoRecorderWrapper","module:WebRTC.RecorderWrapper","module:WebRTC.Support","module:WebRTC.AudioAnalyser","browser:Dom","browser:Info","base:Time","base:Objs","base:Timers.Timer","base:Comparators","browser:Upload.FileUploader","browser:Upload.MultiUploader","base:Promise"],function(e,i,d,r,c,n,o,a,s,u,h,l,p,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this,e),"video"!==this._element.tagName.toLowerCase()&&(this._element=c.changeTag(this._element,"video")),this._recorder=i.create({video:this._element,flip:!!this._options.flip,flipscreen:!!this._options.flipscreen,framerate:this._options.framerate,recordVideo:this._options.recordVideo,recordFakeVideo:!this._options.recordVideo,recordAudio:this._options.recordAudio,recordResolution:{width:this._options.recordingWidth,height:this._options.recordingHeight},resizeMode:this._options.resizeMode,videoBitrate:this._options.videoBitrate,audioBitrate:this._options.audioBitrate,webrtcStreaming:this._options.webrtcStreaming,webrtcStreamingIfNecessary:this._options.webrtcStreamingIfNecessary,localPlaybackRequested:this._options.localPlaybackRequested,screen:this._options.screen,getDisplayMediaSupported:"undefined"!=typeof navigator.mediaDevices.getDisplayMedia,fittodimensions:this._options.fittodimensions,cpuFriendly:this._options.cpuFriendly}),this._recorder.on("bound",function(){this._analyser&&this.testSoundLevel(!0)},this),this._recorder.on("error",function(e,t){this.trigger("error",e,t)},this),this._recorder.on("mainvideostreamended",function(){this.trigger("mainvideostreamended")},this),this._recorder.on("dataavailable",function(e){this.trigger("dataavailable",e)},this),this.ready.asyncSuccess(!0)},destroy:function(){this._analyser&&this._analyser.weakDestroy(),this._recorder.destroy(),t.destroy.call(this)},recordDelay:function(e){return this._recorder.recordDelay(e)},_bindMedia:function(){return this._recorder.bindMedia()},_unbindMedia:function(){return this._recorder.unbindMedia()},lightLevel:function(){return this._recorder.lightLevel()},blankLevel:function(){return this._recorder.blankLevel()},getVolumeGain:function(){return this._recorder.getVolumeGain()},setVolumeGain:function(e){this._recorder.setVolumeGain(e)},deltaCoefficient:function(){return this._recorder.deltaCoefficient()},isWebrtcStreaming:function(){return this._recorder.isWebrtcStreaming()},canPause:function(){return this._recorder.canPause()},soundLevel:function(){return!this._analyser&&this._recorder&&this._recorder.stream()&&r.supported()&&(this._analyser=new r(this._recorder.stream())),this._analyser?this._analyser.soundLevel():1.1},testSoundLevel:function(e){this._analyser&&(this._analyser.weakDestroy(),delete this._analyser),e&&r.supported()&&(this._analyser=new r(this._recorder.stream()))},currentDevices:function(){return{video:this._currentVideo,audio:this._currentAudio}},enumerateDevices:function(){return d.enumerateMediaSources().success(function(e){this._detectCurrentDeviceId(e.video,e.videoCount,!0),this._detectCurrentDeviceId(e.audio,e.audioCount,!1);var t=this.auto_destroy(new s({start:!0,delay:100,context:this,destroy_on_stop:!0,fire:function(){this._currentVideo&&this._currentAudio&&(this.trigger("currentdevicesdetected",{video:this._currentVideo,audio:this._currentAudio}),t.stop())}}))},this)},addMultiStream:function(e,t){return this._recorder.addNewSingleStream(e,t)},updateMultiStreamPosition:function(e,t,i,r){return this._recorder.updateMultiStreamPosition(e,t,i,r)},reverseCameraScreens:function(){return this._recorder.reverseVideos()},setCurrentDevices:function(e){e&&e.video&&this._recorder.selectCamera(e.video),e&&e.audio&&this._recorder.selectMicrophone(e.audio)},setCameraFace:function(e){n.isMobile()&&this._recorder.selectCameraFace(e)},getCameraFacingMode:function(){if(n.isMobile())return this._recorder.getCameraFacingMode()},createSnapshot:function(e){return this._recorder.createSnapshot(e)},removeSnapshot:function(e){},createSnapshotDisplay:function(e,t,i,r,n,o){var s=d.globals().URL.createObjectURL(t),a=document.createElement("img");return a.style.position="absolute",this.updateSnapshotDisplay(t,a,i,r,n,o),a.src=s,"video"===e.tagName.toLowerCase()?c.elementInsertAfter(a,e):c.elementPrependChild(e,a),a},updateSnapshotDisplay:function(e,t,i,r,n,o){t.style.left=i+"px",t.style.top=r+"px",t.style.width=n+"px",t.style.height=o+"px"},removeSnapshotDisplay:function(e){e.remove()},createSnapshotUploader:function(e,t,i){return h.create(a.extend({source:e},i))},startRecord:function(e){return this.__localPlaybackSource=null,this._recorder.startRecord(e)},pauseRecord:function(){return this._recorder.pauseRecord()},resumeRecord:function(){return this._recorder.resumeRecord()},stopRecord:function(n){var o=p.create();return this._recorder.once("data",function(e,t,i){this.__localPlaybackSource={src:e,audiosrc:t};var r=new l;this._options.simulate||i||n.noUploading||(e&&r.addUploader(h.create(a.extend({source:e},n.video))),t&&r.addUploader(h.create(a.extend({source:t},n.audio)))),o.asyncSuccess(r)},this),this._recorder.stopRecord(),o},supportsLocalPlayback:function(){return!(n.isSafari()&&this.isWebrtcStreaming()||!this.__localPlaybackSource.src)},supportsCameraFace:function(){return n.isMobile()},snapshotToLocalPoster:function(e){return e},localPlaybackSource:function(){return this.__localPlaybackSource},averageFrameRate:function(){return this._recorder.averageFrameRate()},_softwareDependencies:function(){var e,t,i;return!this._options.screen||this._options.screen&&"undefined"!=typeof navigator.mediaDevices.getDisplayMedia||d.globals().supportedConstraints.mediaSource?p.value(!0):(e=d.chromeExtensionExtract(this._options.screen),t=[{title:"Screen Recorder Extension",execute:function(){window.open(e.extensionInstallLink)}}],i=o.now(),d.chromeExtensionMessage(e.extensionId,{type:"ping",data:i}).mapError(function(){return t}).mapSuccess(function(e){return!(!e||"success"!==e.type||e.data!==i)||p.error(t)}))},_detectCurrentDeviceId:function(i,r,n){var o,s,e=n?(o=this._recorder._videoTrack,this._recorder._videoTrackSettings):(o=this._recorder._audioTrack,this._recorder._audioTrackSettings);return e&&o?e.deviceId&&i[e.deviceId]?(n?this._currentVideo=i[e.deviceId].id:this._currentAudio=i[e.deviceId].id,i[e.deviceId].id):o.label?(s=1,void a.iter(i,function(e,t){return 0===u.byValue(e.label,o.label)?(n?this._currentVideo=t:this._currentAudio=t,t):r<=s?(n?this._currentVideo=a.ithKey(i):this._currentAudio=a.ithKey(i),a.ithKey(i)):void s++},this)):(n?this._currentVideo=a.ithKey(i):this._currentAudio=a.ithKey(i),a.ithKey(i)):(n?this._currentVideo=a.ithKey(i):this._currentAudio=a.ithKey(i),a.ithKey(i))},errorHandler:function(e){return d.errorHandler(e)}}},{supported:function(e){return!(!i.anySupport(e)||e.screen&&!((n.isChrome()||n.isFirefox()||n.isOpera()||n.isSafari()&&d.globals().MediaRecorder)&&"undefined"!=typeof navigator.mediaDevices.getDisplayMedia||d.globals().supportedConstraints.mediaSource&&n.isFirefox()&&55<n.firefoxVersion()||n.isChrome()&&e.screen.chromeExtensionId||n.isOpera()&&e.screen.operaExtensionId))}})}),e.extend("module:Recorder.WebRTCVideoRecorderWrapper",["module:Recorder.VideoRecorderWrapper","module:Recorder.WebRTCVideoRecorderWrapper"],function(e,t){return e.register(t,2),{}}),e.define("module:WebRTC.AudioAnalyser",["base:Class","browser:Info","module:WebRTC.Support"],function(e,n,i,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this),this._audioContext=i.globals().audioContext,this._analyserNode=this._audioContext.createAnalyser.call(this._audioContext),this._analyserNode.fftSize=32,0<e.getAudioTracks().length&&(this._audioInput=this._audioContext.createMediaStreamSource(e),this._audioInput.connect(this._analyserNode))},destroy:function(){this._analyserNode.disconnect(),delete this._analyserNode,t.destroy.call(this)},soundLevel:function(){if(!this._audioInput)return 0;for(var e=this._analyserNode.fftSize,t=new Uint8Array(e),i=(this._analyserNode.getByteTimeDomainData(t),0),r=0;r<e;r++)i=Math.max(i,Math.abs(t[r]/128));return n.isMobile()&&(n.isFirefox()||n.isAndroid())?i+.1:i}}},{supported:function(){return!(!i.globals().AudioContext||!i.globals().audioContext||n.isSafari()||n.isiOS())}})}),e.define("module:WebRTC.AudioRecorder",["base:Class","base:Events.EventsMixin","base:Objs","base:Promise","base:Functions","module:WebRTC.Support","module:Encoding.WaveEncoder.Support"],function(e,t,r,n,o,s,a,i){return e.extend({scoped:i},[t,function(i){return{constructor:function(e,t){i.constructor.call(this),this._channels=[],this._recordingLength=0,this._options=r.extend({audioChannels:2,bufferSize:16384,sampleRate:44100},t),this._stream=e,this._started=!1,this._stopped=!1,this._volumeGainValue=1},_audioProcess:function(e){this._started&&(this._channels.push(a.dumpInputBuffer(e.inputBuffer,this._options.audioChannels,this._actualBufferSize)),this._recordingLength+=this._actualBufferSize)},destroy:function(){this.stop(),i.destroy.call(this)},getVolumeGain:function(){return this._volumeGainValue},setVolumeGain:function(e){this._volumeGainValue=e,this._volumeGain&&(this._volumeGain.value.gain=e)},__initializeContext:function(){var e=s.globals().AudioContext;this._audioContext=new e,this._actualSampleRate=this._audioContext.sampleRate||this._options.sampleRate,this._volumeGain=this._audioContext.createGain(),this._volumeGain.gain.value=this._volumeGainValue,this._audioInput=this._audioContext.createMediaStreamSource(this._stream),this._audioInput.connect(this._volumeGain),this._scriptProcessor=s.globals().audioContextScriptProcessor.call(this._audioContext,this._options.bufferSize,this._options.audioChannels,this._options.audioChannels),this._actualBufferSize=this._scriptProcessor.bufferSize,this._scriptProcessor.onaudioprocess=o.as_method(this._audioProcess,this),this._volumeGain.connect(this._scriptProcessor),this._scriptProcessor.connect(this._audioContext.destination)},__finalizeContext:function(){this._scriptProcessor.disconnect(),this._volumeGain.disconnect(),this._audioInput.disconnect(),this._scriptProcessor.onaudioprocess=null,this._audioContext.close(),delete this._scriptProcessor,delete this._volumeGain,delete this._audioInput,delete this._audioContext},start:function(){return this._started||(this.__initializeContext(),this._startContextTime=this._audioContext.currentTime,this._started=!0,this._stopped=!1,this._recordingLength=0,this._channels=[],this.trigger("started")),n.value(!0)},stop:function(){this._started&&!this._stopped&&(this._stopContextTime=this._audioContext.currentTime,this._stopped=!0,this.trigger("stopped"),this.__finalizeContext(),this._started=!1,this._generateData())},_generateData:function(){var t=44,e=this._recordingLength*this._options.audioChannels*2+44,i=new ArrayBuffer(e),r=new DataView(i);a.generateHeader(e,this._options.audioChannels,this._actualSampleRate,i),this._channels.forEach(function(e){a.waveChannelTransform(e,1).value().forEach(function(e){r.setInt16(t,e,!0),t+=2})}),this._data=new Blob([r],{type:"audio/wav"}),this._recordingLength=0,this.trigger("data",this._data)}}}],{supported:function(){return!!s.globals().AudioContext}})}),e.define("module:WebRTC.MediaRecorder",["base:Class","base:Events.EventsMixin","base:Functions","base:Promise","browser:Info","module:WebRTC.Support","base:Async"],function(e,t,s,i,a,d,r,n){return e.extend({scoped:n},[t,function(o){return{constructor:function(e,t){t=t||{},o.constructor.call(this),this._stream=e,this._started=!1;var i=d.globals().MediaRecorder,r={mimeType:""};try{t.audioonly?i.isTypeSupported("audio/mp3")?r={mimeType:"audio/mp3"}:i.isTypeSupported("audio/ogg;codecs=opus")&&(r={mimeType:"audio/ogg;codecs=opus"}):"undefined"==typeof i.isTypeSupported?r={mimeType:"video/webm"}:i.isTypeSupported("video/webm;codecs=vp9")&&!t.cpuFriendly?r={mimeType:"video/webm;codecs=vp9"}:i.isTypeSupported("video/webm;codecs=vp8")?r={mimeType:"video/webm;codecs=vp8"+(a.isFirefox()&&71<=a.firefoxVersion()?",opus":"")}:i.isTypeSupported("video/webm")?r={mimeType:"video/webm"}:i.isTypeSupported("video/webm;codecs=vp9")?r={mimeType:"video/webm;codecs=vp9"}:i.isTypeSupported("video/mp4")&&(r={mimeType:"video/mp4"})}catch(n){r={}}t.videoBitrate&&(r.videoBitsPerSecond=1e3*t.videoBitrate),t.audioBitrate&&(r.audioBitsPerSecond=1e3*t.audioBitrate),this.__audioonly=t.audioonly,this.__mediaRecorderOptions=r,this._mediaRecorder=new i(e,r),this._mediaRecorder.ondataavailable=s.as_method(this._dataAvailable,this),this._mediaRecorder.onstop=s.as_method(this._dataStop,this),this._mediaRecorder.onpause=s.as_method(this._hasPaused,this),this._mediaRecorder.onresume=s.as_method(this._hasResumed,this),this._mediaRecorder.onstart=s.as_method(this._recorderStarted,this),this._mediaRecorder.onerror=s.as_method(this.onErrorMethod,this)},_recorderStarted:function(e){this._started=!0,this.trigger("started"),this._startRecPromise.asyncSuccess()},onErrorMethod:function(e){this._startRecPromise.asyncError(e),this.trigger("error",e)},destroy:function(){this.stop(),o.destroy.call(this)},start:function(){return this._started?i.value(!0):(this._startRecPromise=i.create(),this._chunks=[],this._mediaRecorder.start(10),!a.isSafari()||"onstart"in MediaRecorder.prototype||(this._started=!0,this.trigger("started"),r.eventually(function(){"recording"===this._mediaRecorder.state?this._startRecPromise.asyncSuccess():this._startRecPromise.asyncError("Could not start recording")},this,1e3)),this._startRecPromise)},pause:function(){!this._paused&&this._started&&(this._paused=!0,this._mediaRecorder.pause(),this.trigger("pause"))},_hasPaused:function(){this.trigger("paused")},resume:function(){this._paused&&this._started&&(this._paused=!1,this._mediaRecorder.resume(),this.trigger("resume"))},_hasResumed:function(){this.trigger("resumed")},stop:function(){this._started&&(this._started=!1,this._mediaRecorder.stop(),this.trigger("stopped"))},_dataAvailable:function(e){this.trigger("dataavailable",e),e.data&&0<e.data.size&&this._chunks.push(e.data)},_dataStop:function(e){var t,i;this._data=new Blob(this._chunks,{type:this.__mediaRecorderOptions.mimeType.split(";")[0]||(this.__audioonly?"audio/ogg":"video/webm")}),this._chunks=[],a.isFirefox()?(t=this,(i=new FileReader).onload=function(){t._data=new Blob([this.result],{type:t._data.type}),t.trigger("data",t._data)},i.readAsArrayBuffer(this._data)):this.trigger("data",this._data)}}}],{supported:function(){return!(!d.globals().MediaRecorder||0!==document.location.href.indexOf("https://")&&"localhost"!==document.location.hostname&&(a.isOpera()||a.isChrome())||a.isOpera()&&a.operaVersion()<44||a.isChrome()&&a.chromeVersion()<57)}})}),e.define("module:WebRTC.PeerRecorder",["base:Class","base:Events.EventsMixin","base:Functions","base:Objs","base:Promise","base:Async","browser:Info","module:WebRTC.Support"],function(e,t,n,s,o,r,a,d,i){return e.extend({scoped:i},[t,function(i){return{constructor:function(e,t){i.constructor.call(this),this._stream=e,!t.videoBitrate&&t.recorderWidth&&t.recorderHeight&&(t.videoBitrate=Math.round(t.recorderWidth*t.recorderHeight/250)),this._videoBitrate=t.videoBitrate||1024,this._audioBitrate=t.audioBitrate||256,this._videoFrameRate=t.framerate,this._audioonly=t.audioonly,this._started=!1},destroy:function(){this.stop(),i.destroy.call(this)},start:function(e){if(this._started)return o.value(!0);this._wssUrl=e.wssUrl,this._streamInfo=e.streamInfo,this._userData=e.userData||{},this._delay=e.delay||0,this._started=!0,this._wsConnection=new(d.globals().WebSocket)(this._wssUrl),this._wsConnection.binaryType="arraybuffer",this._wsConnection.onopen=n.as_method(this._wsOnOpen,this),this._wsConnection.onmessage=n.as_method(this._wsOnMessage,this),this._wsConnection.onclose=n.as_method(this._wsOnClose,this),this._wsConnection.onerror=this._errorCallback("WS_CONNECTION");var t=o.create(),i={},r=this;return this.on("started",function(){r.off(null,null,i),t.asyncSuccess(!0)},i).on("error",function(e){r.off(null,null,i),t.asyncError(e)},i),t},stop:function(){this._started&&(this._started=!1,this._peerConnection&&this._peerConnection.close(),this._peerConnection=null,this._wsConnection&&this._wsConnection.close(),this._wsConnection=null,this.trigger("stopped"))},_wsOnOpen:function(){this._peerConnection=new(d.globals().RTCPeerConnection)({iceServers:[]}),this._stream.getTracks&&this._peerConnection.addTrack?s.iter(this._stream.getTracks(),function(e){this._peerConnection.addTrack(e,this._stream)},this):this._peerConnection.addStream(this._stream);var e=this._peerConnection.createOffer();e.then(n.as_method(this._offerGotDescription,this)),e["catch"](this._errorCallback("PEER_CREATE_OFFER"))},_wsOnMessage:function(e){var e=JSON.parse(e.data),t=parseInt(e.status,10);e.command;200!==t?this._error("MESSAGE_ERROR",{status:t,description:e.statusDescription}):(e.sdp!==undefined&&((t=this._peerConnection.setRemoteDescription(new(d.globals().RTCSessionDescription)(e.sdp))).then(function(){}),t["catch"](this._errorCallback("PEER_REMOTE_DESCRIPTION"))),e.iceCandidates&&s.iter(e.iceCandidates,function(e){this._peerConnection.addIceCandidate(new(d.globals().RTCIceCandidate)(e))},this),r.eventually(function(){this.trigger("started")},this,this._delay)),this._wsConnection&&this._wsConnection.close(),this._wsConnection=null},_offerGotDescription:function(e){var t={};return this._audioBitrate&&(t.audioBitrate=Number(this._audioBitrate)),this._videoBitrate&&!this._audioonly&&(t.videoBitrate=Number(this._videoBitrate)),this._videoFrameRate&&!this._audioonly&&(t.videoFrameRate=Number(this._videoFrameRate)),e.sdp=this._enhanceSDP(e.sdp,t),this._peerConnection.setLocalDescription(e).then(n.as_method(function(){this._wsConnection.send(JSON.stringify({direction:"publish",command:"sendOffer",streamInfo:this._streamInfo,sdp:e,userData:this._userData}))},this))["catch"](this._errorCallback("Peer Local Description"))},_enhanceSDP:function(e,i){var e=e.split(/\r\n/),r="header",n=!1,o="";return s.iter(e,function(e){var t;e.length<=0||(o+=e+"\r\n",0===e.indexOf("m=audio")?n=!(r="audio"):0===e.indexOf("m=video")?n=!(r="video"):0===e.indexOf("a=rtpmap")&&(n=!(r="bandwidth")),0===e.indexOf("i="))||0===e.indexOf("c=")||n||(0==="audio".localeCompare(r)?i.audioBitrate!==undefined&&(o=(o+="b=AS:"+i.audioBitrate+"\r\n")+"b=TIAS:"+1024*i.audioBitrate+"\r\n"):0==="video".localeCompare(r)?i.videoBitrate!==undefined&&(o=(o+="b=AS:"+i.videoBitrate+"\r\n")+"b=CT:"+i.videoBitrate+"\r\n",i.videoFrameRate!==undefined)&&(o+="a=framerate:"+i.videoFrameRate+"\r\n"):0==="bandwidth".localeCompare(r)&&a.isChrome()&&null!==(e=this._getRTPMapID(e))&&(t=e[2].toLowerCase(),0!=="vp9".localeCompare(t)&&0!=="vp8".localeCompare(t)&&0!=="h264".localeCompare(t)&&0!=="red".localeCompare(t)&&0!=="ulpfec".localeCompare(t)&&0!=="rtx".localeCompare(t)||i.videoBitrate!==undefined&&(o+="a=fmtp:"+e[1]+" x-google-min-bitrate="+i.videoBitrate+";x-google-max-bitrate="+i.videoBitrate+"\r\n"),0!=="opus".localeCompare(t)&&0!=="isac".localeCompare(t)&&0!=="g722".localeCompare(t)&&0!=="pcmu".localeCompare(t)&&0!=="pcma".localeCompare(t)&&0!=="cn".localeCompare(t)||i.audioBitrate!==undefined&&(o+="a=fmtp:"+e[1]+" x-google-min-bitrate="+i.audioBitrate+";x-google-max-bitrate="+i.audioBitrate+"\r\n")),n=!0)},this),o},_getRTPMapID:function(e){var t=new RegExp("a=rtpmap:(\\d+) (\\w+)/(\\d+)"),t=e.match(t);return t&&3<=t.length?t:null},_wsOnClose:function(){},_error:function(e,t){this.trigger("error",e+" "+t.toString(),t),this.stop()},_errorCallback:function(t){return n.as_method(function(e){this._error(t,e)},this)}}}],{supported:function(){if(a.isEdge())return!1;if(a.isSafari()&&a.safariVersion()<11)return!1;if(0!==document.location.href.indexOf("https://")&&"localhost"!==document.location.hostname){if(a.isChrome()&&47<=a.chromeVersion())return!1;if(a.isOpera()&&34<=a.operaVersion())return!1}return d.globals().RTCPeerConnection&&d.globals().RTCIceCandidate&&d.globals().RTCSessionDescription&&d.globals().WebSocket}})}),e.define("module:WebRTC.RecorderWrapper",["base:Classes.ConditionalInstance","base:Events.EventsMixin","base:Objs","base:Async","base:Promise","base:Time","module:WebRTC.Support","module:Recorder.Support","module:Recorder.PixelSampleMixin","browser:Events"],function(e,t,c,u,i,r,h,n,o,s,a){return e.extend({scoped:a},[t,o,function(t){return{constructor:function(e){t.constructor.call(this,e),this._video=e.video,this._localPlaybackRequested=e.localPlaybackRequested,this._recording=!1,this._bound=!1,this._hasAudio=!1,this._hasVideo=!1,this._screen=e.screen,this._resizeMode=e.resizeMode,this._flip=!!e.flip,this._screen&&!e.flipscreen&&(this._flip=!1),this._videoTrackSettings={slippedFromOrigin:{height:1,width:1}},this._options.fittodimensions&&(null===this._screen?(this._initCanvasStreamSettings(),this._prepareRecorderStreamCanvas(!0)):this._options.fittodimensions=!1)},_getConstraints:function(){return{audio:!!this._options.recordAudio&&{deviceId:this._options.audioId},video:!!this._options.recordVideo&&{frameRate:this._options.framerate,sourceId:this._options.videoId,width:this._options.recordResolution.width,height:this._options.recordResolution.height,cameraFaceFront:this._options.cameraFaceFront,resizeMode:this._resizeMode},screen:this._screen}},addNewSingleStream:function(e,t){this._initCanvasStreamSettings();var i=!0,r=this._options.video.aspectRatio,n=t.positionX||0,o=t.positionY||0,s=t.width||.2*this._options.recordResolution.width||120,t=t.height;return t||(t=r?Math.floor(s*r):Math.floor(s/1.33),i=!1),e={video:r={frameRate:this._options.framerate,sourceId:e.id,cameraFaceFront:this._options.cameraFaceFront}},this._prepareRecorderStreamCanvas(),this._multiStreamConstraints=e,this.__addedStreamOptions=c.tree_merge(r,{positionX:n,positionY:o,width:s,height:t,isTrueHeight:i}),this.addNewMediaStream()},updateMultiStreamPosition:function(e,t,i,r){this.__addedStreamOptions.positionX=e||this.__addedStreamOptions.positionX,this.__addedStreamOptions.positionY=t||this.__addedStreamOptions.positionY,this.__addedStreamOptions.width=i||this.__addedStreamOptions.width,this.__addedStreamOptions.height=r||this.__addedStreamOptions.height},addNewMediaStream:function(){var t=i.create();return this._canvasStreams.length<1&&this._canvasStreams.push(this._stream),h.userMedia2(this._multiStreamConstraints,this).success(function(e){this._canvasStreams.push(e),this._buildVideoElementsArray(t),this.on("stream-canvas-drawn",function(){return t.asyncSuccess()},this)},this)},recordDelay:function(e){return 0},stream:function(){return this._stream},isWebrtcStreaming:function(){return!1},canPause:function(){return!1},bindMedia:function(){if(!this._bound)return h.userMedia2(this._getConstraints()).success(function(e){var t,i,r,n;this._options&&(this._hasAudio=this._options.recordAudio&&0<e.getAudioTracks().length,this._hasVideo=this._options.recordVideo&&0<e.getVideoTracks().length,t=n=i=null,r=e.getVideoTracks()[0]||{},this._hasVideo&&"function"==typeof r.getSettings&&(i=r.getSettings(),"undefined"!=typeof r.onended)&&this.auto_destroy(new s).on(r,"ended",function(e){this.trigger("mainvideostreamended")},this),this._hasVideo&&"function"==typeof r.getCapabilities&&i&&(t=r.getCapabilities(),n=this._getConstraints().video,t.width.max)&&t.height.max&&this.__checkAndApplyCorrectConstraints(r,t,n,e),i&&n&&this._options.fittodimensions&&(r=n.width/n.height,n=i.width/i.height,Math.abs(r-n)<=.1)&&(this._options.fittodimensions=!1),this._options.fittodimensions&&i?(this._canvasStreams.push(e),this.__initialVideoTrackSettings||this.__calculateVideoTrackSettings(i,this._video,!0),this._videoTrackSettings.capabilities=t,this._videoTrackSettings.constrainsts=this._getConstraints().video,this._buildVideoElementsArray()):(this._bound=!0,this._stream=e,this._setLocalTrackSettings(e),h.bindStreamToVideo(e,this._video,this._flip),this.trigger("bound",e),this._boundMedia()))},this)},selectCamera:function(e){this._options.videoId=e,this._bound&&(this.unbindMedia(),this.bindMedia(),this.trigger("rebound"))},selectMicrophone:function(e){this._options.audioId=e,this._bound&&(this.unbindMedia(),this.bindMedia(),this.trigger("rebound"))},selectCameraFace:function(e){this._options.cameraFaceFront=e,this._bound&&(this.unbindMedia(),this.bindMedia(),this.trigger("rebound"))},getCameraFacingMode:function(){return!0===this._options.cameraFaceFront?"user":!1===this._options.cameraFaceFront?"environment":undefined},startRecord:function(e){if(this._recording)return i.value(!0);this._recording=!0;e=this._startRecord(e);return e.success(function(){this._pausedDuration=0,this._startTime=r.now()},this),e},pauseRecord:function(){this.canPause()&&!this._paused&&(this._paused=!0,this._recorder.once("paused",function(){this.trigger("paused"),this.__pauseStartTime=r.now()},this),this._recorder.pause())},resumeRecord:function(){this.canPause()&&this._paused&&(this._paused=!1,this._recorder.once("resumed",function(){this.trigger("resumed"),this._pausedDuration+=r.now()-this.__pauseStartTime,delete this.__pauseStartTime},this),this._recorder.resume())},stopRecord:function(){this._recording&&(this._recording=!1,this._stopRecord(),this._stopTime=r.now())},duration:function(){return(this._recording||!this._stopTime?r.now():this._stopTime)-this._startTime-this._pausedDuration-(this.__pauseStartTime!==undefined?r.now()-this.__pauseStartTime:0)},unbindMedia:function(){this._bound&&!this._recording&&(h.stopUserMediaStream(this._stream,this._sourceTracks),this._bound=!1,this.trigger("unbound"),this._unboundMedia())},createSnapshot:function(e){return n.createSnapshot(e,this._video)},_pixelSample:function(e,t,i){if(this._video.videoWidth){e=e||100;var r=this._video.videoWidth,n=this._video.videoHeight,o=Math.ceil(Math.sqrt(r/n*e)),n=Math.ceil(Math.sqrt(n/r*e)),r=document.createElement("canvas"),s=(r.width=o,r.height=n,r.getContext("2d"));s.drawImage(this._video,0,0,o,n);for(var a=0;a<e;++a){var d=a%o,c=Math.floor(a/o),d=s.getImageData(d,c,1,1).data;t.call(i||this,d[0],d[1],d[2])}}else t.call(i||this,0,0,0)},_initCanvasStreamSettings:function(){this._canvasStreams=[],this._videoElements=[],this._audioInputs=[],this._sourceTracks=[],this._multiStreamConstraints={},this._drawingStream=!1},_prepareRecorderStreamCanvas:function(e){var t,i;this.__recorderStreamCanvas&&this.__recorderStreamCtx||(t=this._videoTrackSettings.height||this._video.clientHeight||this._video.videoHeight,i=this._videoTrackSettings.width||this._video.clientWidth||this._video.videoWidth,"undefined"==typeof this.__recorderStreamCanvas&&(this.__recorderStreamCanvas=document.createElement("canvas")),this.__recorderStreamCanvas.setAttribute("width",i),this.__recorderStreamCanvas.setAttribute("height",t),this.__recorderStreamCanvas.setAttribute("style","position:fixed; left: 200%; pointer-events: none"),this.__recorderStreamCtx=this.__recorderStreamCanvas.getContext("2d"),this._drawerSetting={fittodimensions:e||!1,streamsReversed:!1,isMultiStream:!1})},_setLocalTrackSettings:function(e){var t,i;void 0!==e.getVideoTracks()&&e.getVideoTracks()[0]&&((t=this)._videoTrack=e.getVideoTracks()[0],this._options.getDisplayMediaSupported?"undefined"!=typeof this._videoTrack.getSettings&&(i=this._videoTrack.getSettings(),"undefined"==typeof this._videoTrackSettings.videoInnerFrame&&(this._videoTrackSettings=c.extend(i,this._videoTrackSettings)),this._video.onloadedmetadata=function(e){t.__calculateVideoTrackSettings(i,e.target,!0)}):("undefined"==typeof this._resizeMode&&(this._resizeMode="none"),this._videoTrack.applyConstraints({resizeMode:this._resizeMode}).then(function(){"undefined"!=typeof t._videoTrack.getSettings&&(t._videoTrackSettings=c.extend(i,t._videoTrackSettings))}))),"undefined"!=typeof e.getAudioTracks&&e.getAudioTracks()[0]&&(this._audioTrack=e.getAudioTracks()[0],void 0!==this._audioTrack.getSettings())&&(this._audioTrackSettings=this._audioTrack.getSettings())},__checkAndApplyCorrectConstraints:function(e,t,i){var r,n,o,s,a=t.width.max,d=t.height.max;if(i.width>a||i.height>d)return o=i.width/i.height,t.aspectRatio.min&&t.aspectRatio.max?(o=i.width/i.height,s=t.aspectRatio.min,t=t.aspectRatio.max,1<o&&t<o?o=t:o<1&&o<s&&(o=s)):o=a/d,i.width>a&&i.height>d?(r=1<o?a:d*o,a<(r=d<(n=1<o?a/o:d)&&1<o?(n=d)/o:r)&&o<1&&(n=(r=a)/o)):i.width>a?(n=1<o?a/o:Math.min(d,i.height),r=1<o?a:n*o):i.height>d&&(r=1<o?Math.min(a,i.width):d*o,n=1<o?r/o:d),{width:r,height:n}},__calculateVideoTrackSettings:function(e,t,i){t=t||this._video;var r,n,o,s,a=e.aspectRatio||e.width/e.height;if(!isNaN(a))return n=(r=t.offsetWidth)<=(t=t.offsetHeight)*a?r:Math.round(t*a),a=t*a<r?t:Math.round(r/a),o=e.width>n?e.width/n:n/e.width,s=e.height>a?e.height/a:a/e.height,e=c.extend(e,{videoElement:{width:r,height:t},videoInnerFrame:{width:n,height:a},slippedFromOrigin:{width:o,height:s}}),i&&(this.__initialVideoTrackSettings=e),this._videoTrackSettings=e},_buildVideoElementsArray:function(n){this.__multiStreamVideoSettings={isMainStream:!0,mainStream:{},smallStream:{}},c.iter(this._canvasStreams,function(t,e){var i=t.getTracks(),r=!1;c.iter(i,function(e){this._sourceTracks.push(e),"video"===e.kind&&(this._videoTrack&&(r=e.id!==this._videoTrack.id,this._drawerSetting.isMultiStream=!0),this._videoElements.push(this._arraySingleVideoElement(this.__addedStreamOptions,t,r,e))),"audio"===e.kind&&this._audioInputs.push(e)},this),this._videoElements.length+this._audioInputs.length===i.length&&this._startDrawRecorderToCanvas(t),u.eventually(function(){if(!this._drawingStream)return!!n&&n.asyncError({message:"Could not be able to get required tracks"})},this,1e3)},this)},_startDrawRecorderToCanvas:function(e){try{var t,i,r,n,o,s,a,d,c,u=e.getVideoTracks()[0].getSettings();u.aspectRatio&&.1<Math.abs(u.aspectRatio-this._videoTrackSettings.aspectRatio)&&(this._videoTrackSettings.aspectRatio=u.aspectRatio,this.__calculateVideoTrackSettings(u,null,!0),this.__recorderStreamCanvas.setAttribute("width",u.width),this.__recorderStreamCanvas.setAttribute("height",u.height)),this._drawingStream=!0,this._drawerSetting.fittodimensions&&"undefined"!=typeof this._videoTrackSettings.videoInnerFrame&&(t={},i=this._videoTrackSettings.width,r=this._videoTrackSettings.height,n=(this.__recorderStreamCanvas.width=i)/(this.__recorderStreamCanvas.height=r),o=this._videoTrackSettings.videoInnerFrame,s=this._videoTrackSettings.videoElement,d=(a=this._videoTrackSettings.constrainsts).width/a.height,c=o.width===s.width,.1<=Math.abs(n-d)&&(c?(t.ch=Math.round(i/d),r<t.ch&&(c=!1)):(t.cw=1<n?Math.round(r*d):Math.round(r/d),i<t.cw&&(c=!0)),c?(t.cw=i,t.ch=Math.round(i/d),t.cx=0,t.cy=(r-t.ch)/2,t.w=t.cw,t.h=t.ch,t.x=0,t.y=(r-t.h)/2):(t.ch=r,t.cw=1<n?Math.round(r*d):Math.round(r/d),t.cy=0,t.cx=(i-t.cw)/2,t.w=t.cw,t.h=t.ch,t.y=0,t.x=(i-t.w)/2)),this.__cropSettings=t),this._drawTracksToCanvas(),this._startCanvasStreaming()}catch(h){console.warn(h)}},_drawTracksToCanvas:function(){if(this._drawingStream){var e=this._videoElements.length,t=!1;"undefined"!=typeof this._drawerSetting&&this._drawerSetting.streamsReversed&&(t=!0);for(var i=0;i<this._videoElements.length;i++){var r,n,o,s,a,d=this._videoElements[i];this._drawerSetting.fittodimensions?(n=(r=this.__cropSettings).w,o=r.h,s=r.x,a=r.y,this.__recorderStreamCtx.drawImage(d,r.cx,r.cy,r.cw,r.ch,s,a,n,o)):(s=(r=0!==i?this.__addedStreamOptions:{}).positionX||0,a=r.positionY||0,d.__multistreamElement?(n=t?this._drawerSetting.smallStreamWidth:r.width||360,o=t?this._drawerSetting.smallStreamHeight:r.height||240):t?(s=this._drawerSetting.positionX,a=this._drawerSetting.positionY,n=this._drawerSetting.width,o=this._drawerSetting.height,this.__multiStreamVideoSettings.mainStream&&0<c.keys(this.__multiStreamVideoSettings.mainStream).length&&(this.__recorderStreamCtx.fillStyle="#000000",this.__recorderStreamCtx.fillRect(0,0,this.__recorderStreamCanvas.width,this.__recorderStreamCanvas.height),this.__recorderStreamCtx.restore())):(n=this.__recorderStreamCanvas.width||r.width||360,o=this.__recorderStreamCanvas.height||r.height||240),this.__recorderStreamCtx.drawImage(d,s,a,n,o)),0===--e&&u.eventually(this._drawTracksToCanvas,this,20)}}},reverseVideos:function(){var e,t,i,r,n,o,s=this.__multiStreamVideoSettings.isMainStream,a=(this.__multiStreamVideoSettings.isMainStream=!s,this.__multiStreamVideoSettings.mainStream.settings),d=this.__multiStreamVideoSettings.smallStream.settings;if(s?(n=d.aspectRatio,o=this._videoTrackSettings.aspectRatio||this._videoTrackSettings.width/this._videoTrackSettings.height,this._videoTrackSettings.videoElement.width===this._videoTrackSettings.videoInnerFrame.width?(e=(t=a.streamHeight)*n,r=(i=d.videoWidth)/o):(t=(e=a.streamWidth)/n,i=(r=d.videoHeight)*o),n=(a.streamWidth-e)/2,o=(a.streamHeight-t)/2,this._drawerSetting={streamsReversed:!0,width:e,height:t,positionX:n,positionY:o,smallStreamHeight:r,smallStreamWidth:i}):(this._drawerSetting.streamsReversed=!1,i=d.videoWidth,r=d.videoHeight),this._drawingStream)for(var c,u=document.createElement("video"),h=0;h<this._videoElements.length;h++)u.srcObject?u.srcObject&&(this._videoElements[h].srcObject=u.srcObject,this._videoElements[h].load(),this._videoElements[h].oncanplay=function(){this.play()},c={width:i,height:r},s?this.__calculateVideoTrackSettings(c):this._videoTrackSettings=this.__initialVideoTrackSettings,this.trigger("multistream-camera-switched",c,s),u.remove()):(u.srcObject=this._videoElements[h].srcObject,this._videoElements[h].srcObject=this._videoElements[h+1].srcObject,this._videoElements[h].load(),this._videoElements[h].oncanplay=function(){this.play()})},_startCanvasStreaming:function(){var e=this.__recorderStreamCanvas.captureStream(25);this._audioInputs[0]&&e.addTrack(this._audioInputs[0]),this._stream=e,h.bindStreamToVideo(e,this._video,this._flip),this.trigger("bound",e),this.trigger("stream-canvas-drawn"),this._setLocalTrackSettings(e),this._boundMedia(e)},_arraySingleVideoElement:function(e,t,n,o){var s,a=this,t=h.bindStreamToVideo(t),d=((n=n||!1)?(t.__multistreamElement=!0,t.width=this.__addedStreamOptions.width||e.width||360,t.height=this.__addedStreamOptions.height||e.height||240):(s=a._videoTrackSettings.videoInnerFrame,a._videoTrackSettings.aspectRatio),a._videoTrackSettings.slippedFromOrigin);return t.muted=!0,t.volume=0,t.oncanplay=function(){var e=o.getSettings(),t=this.width,i=this.height,r=n?e.aspectRatio||e.width/e.height:r,t=("undefined"!=typeof a.__addedStreamOptions&&!a.__addedStreamOptions._isTrueHeight&&n&&r&&(i=(1<r?t/r:t*r).toFixed(2),a.__addedStreamOptions.height=i,a.updateMultiStreamPosition()),{track:o,isMainScreen:n,settings:{videoWidth:n?t:a._videoTrackSettings.videoElement.width,videoHeight:n?i:a._videoTrackSettings.videoElement.height,streamWidth:(n?e:a._videoTrackSettings).width,streamHeight:(n?e:a._videoTrackSettings).height,visibleWidth:n?t/d.width:s.width,visibleHeight:n?i/d.height:s.height,deviceId:e.deviceId,aspectRatio:r}});n?a.__multiStreamVideoSettings.smallStream=t:a.__multiStreamVideoSettings.mainStream=t,this.play()},t},_boundMedia:function(){},_unboundMedia:function(){},_startRecord:function(e){},_stopRecord:function(){},_error:function(e,t){this.trigger("error",e,t)},getVolumeGain:function(){},setVolumeGain:function(e){},_dataAvailable:function(e,t,i){this.destroyed()||this.trigger("data",e,t,i)},destroy:function(){this.stopRecord(),this.unbindMedia(),t.destroy.call(this)},averageFrameRate:function(){return null}}}],{_initializeOptions:function(e){return c.extend({recordAudio:!0,recordVideo:!0,recordResolution:{width:320,height:200}},e)},supported:function(e){return!!h.globals().getUserMedia&&!!h.globals().URL}})}),e.define("module:WebRTC.PeerRecorderWrapper",["module:WebRTC.RecorderWrapper","module:WebRTC.PeerRecorder","module:WebRTC.MediaRecorder","browser:Info","base:Async"],function(e,i,t,r,n,o){return e.extend({scoped:o},{_boundMedia:function(){this._recorder=new i(this._stream,{recorderWidth:this._options.recordResolution.width,recorderHeight:this._options.recordResolution.height,videoBitrate:this._options.videoBitrate,audioBitrate:this._options.audioBitrate,framerate:this._options.framerate,audioonly:!this._options.recordVideo}),this._localPlaybackRequested&&t.supported()&&(this.__localMediaRecorder=new t(this._stream)),this._recorder.on("error",this._error,this)},_unboundMedia:function(){this._recorder.destroy(),this.__localMediaRecorder&&this.__localMediaRecorder.weakDestroy()},_startRecord:function(e){return this.__localMediaRecorder&&this.__localMediaRecorder.start(),this._recorder.start(e.webrtcStreaming)},isWebrtcStreaming:function(){return!0},_stopRecord:function(){this._recorder.stop();var t=null;this.__localMediaRecorder&&(this.__localMediaRecorder.once("data",function(e){t=e}),this.__localMediaRecorder.stop()),n.eventually(function(){this._dataAvailable(t,null,!0)},this,this.__stopDelay||this._options.webrtcStreaming.stopDelay||0)},recordDelay:function(e){return this.__stopDelay=e.webrtcStreaming.stopDelay,e.webrtcStreaming.delay||0},getVolumeGain:function(){},setVolumeGain:function(e){},averageFrameRate:function(){return null}},function(t){return{supported:function(e){return!!t.supported.call(this,e)&&(!e.screen||!r.isFirefox())&&e.webrtcStreaming&&i.supported()}}})}),e.define("module:WebRTC.PeerRecorderWrapperIfNecessary",["module:WebRTC.PeerRecorderWrapper","base:Objs"],function(e,i,t){return e.extend({scoped:t},{},function(t){return{supported:function(e){return e.webrtcStreamingIfNecessary&&((e=i.clone(e,1)).webrtcStreamingIfNecessary=!1,e.webrtcStreaming=!0),t.supported.call(this,e)}}})}),e.define("module:WebRTC.MediaRecorderWrapper",["module:WebRTC.RecorderWrapper","module:WebRTC.MediaRecorder"],function(e,i,t){return e.extend({scoped:t},{_boundMedia:function(e){e=e||this._stream,this._recorder=new i(e,{videoBitrate:this._options.videoBitrate,audioBitrate:this._options.audioBitrate,audioonly:!this._options.recordVideo,cpuFriendly:this._options.cpuFriendly}),this._recorder.on("dataavailable",function(e){this.trigger("dataavailable",e)},this),this._recorder.on("data",function(e){this._dataAvailable(e)},this)},_unboundMedia:function(){this._recorder.destroy(),this._drawingStream&&this._initCanvasStreamSettings()},_startRecord:function(){return this._recorder.start()},_stopRecord:function(){this._recorder.stop()},canPause:function(){return!0},getVolumeGain:function(){},setVolumeGain:function(e){},averageFrameRate:function(){return null}},function(t){return{supported:function(e){return!!t.supported.call(this,e)&&!e.recordFakeVideo&&i.supported()}}})}),e.define("module:WebRTC.WhammyAudioRecorderWrapper",["module:WebRTC.RecorderWrapper","module:WebRTC.AudioRecorder","module:WebRTC.WhammyRecorder","browser:Info","base:Promise"],function(e,i,r,n,t,o){return e.extend({scoped:o},{_createSnapshot:function(e){return this._whammyRecorder.createSnapshot(e)},_boundMedia:function(){this._videoBlob=null,this._audioBlob=null,this._hasVideo?this._whammyRecorder=new r(this._stream,{video:this._video,framerate:this._options.framerate}):this._whammyRecorder=new r(null,{framerate:this._options.framerate}),this._hasAudio&&(this._audioRecorder=new i(this._stream),this._audioRecorder.on("data",function(e){this._audioBlob=e,!this._videoBlob&&this._hasVideo||this._dataAvailable(this._videoBlob,this._audioBlob)},this)),this._whammyRecorder.on("data",function(e){this._videoBlob=e,!this._audioBlob&&this._hasAudio||this._dataAvailable(this._videoBlob,this._audioBlob)},this)},_unboundMedia:function(){this._hasAudio&&this._audioRecorder.destroy(),this._whammyRecorder.destroy()},_startRecord:function(){var e=[];return e.push(this._whammyRecorder.start()),this._hasAudio&&e.push(this._audioRecorder.start()),t.and(e)},_stopRecord:function(){this._whammyRecorder.stop(),this._hasAudio&&this._audioRecorder.stop()},getVolumeGain:function(){return this._audioRecorder?this._audioRecorder.getVolumeGain():1},setVolumeGain:function(e){this._audioRecorder&&this._audioRecorder.setVolumeGain(e)},averageFrameRate:function(){return this._whammyRecorder.averageFrameRate()}},function(t){return{supported:function(e){if(!t.supported.call(this,e))return!1;if(0!==document.location.href.indexOf("https://")&&"localhost"!==document.location.hostname){if(n.isChrome()&&47<=n.chromeVersion())return!1;if(n.isOpera()&&34<=n.operaVersion())return!1}return i.supported()&&r.supported(!e.recordVideo)}}})}),e.extend("module:WebRTC.RecorderWrapper",["module:WebRTC.RecorderWrapper","module:WebRTC.PeerRecorderWrapper","module:WebRTC.MediaRecorderWrapper","module:WebRTC.WhammyAudioRecorderWrapper","module:WebRTC.PeerRecorderWrapperIfNecessary"],function(e,t,i,r,n){return e.register(t,4),e.register(i,3),e.register(r,2),e.register(n,1),{}}),e.define("module:WebRTC.Support",["base:Promise","base:Objs","browser:Info","browser:Dom","base:Time"],function(c,u,h,d,l){return{canvasSupportsImageFormat:function(e){try{var t=document.createElement("canvas").toDataURL(e);t.indexOf(";");return-1!=t.substring(0,t.indexOf(";")).indexOf(e)}catch(i){return!1}},getGlobals:function(){var e=null,t=null,t=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(e=navigator.mediaDevices.getUserMedia,navigator.mediaDevices):(e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator),i=window.URL||window.webkitURL,r=window.MediaRecorder,n=window.AudioContext||window.webkitAudioContext,o=(n&&d.userInteraction(function(){this.__globals&&(this.__globals.audioContext=new n)},this),window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection),s=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate,a=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription;return{getUserMedia:e,getUserMediaCtx:t,URL:i,MediaRecorder:r,AudioContext:n,audioContextScriptProcessor:function(){return(this.createScriptProcessor||this.createJavaScriptNode).apply(this,arguments)},webpSupport:this.canvasSupportsImageFormat("image/webp"),RTCPeerConnection:o,RTCIceCandidate:s,RTCSessionDescription:a,WebSocket:window.WebSocket,supportedConstraints:navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints?navigator.mediaDevices.getSupportedConstraints():{}}},globals:function(){return this.__globals||(this.__globals=this.getGlobals()),this.__globals},userMediaSupported:function(){return!!this.globals().getUserMedia},enumerateMediaSources:function(){var t=c.create(),e=function(e){var i={audio:{},audioCount:0,video:{},videoCount:0};u.iter(e,function(e){var t;0===e.kind.indexOf("video")&&(i.videoCount++,"undefined"!=typeof e.getCapabilities&&(t=e.getCapabilities()),i.video[e.id||e.deviceId]={id:e.id||e.deviceId,label:e.label,capabilities:t}),0===e.kind.indexOf("audio")&&(i.audioCount++,"undefined"!=typeof e.getCapabilities&&(t=e.getCapabilities()),i.audio[e.id||e.deviceId]={id:e.id||e.deviceId,label:e.label,capabilities:t})}),t.asyncSuccess(i)};try{navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(e):MediaStreamTrack&&MediaStreamTrack.getSources?MediaStreamTrack.getSources(e):t.asyncError("Unsupported")}catch(i){t.asyncError(i)}return t},streamQueryResolution:function(e){var t=c.create(),i=this.bindStreamToVideo(e);return i.addEventListener("playing",function(){setTimeout(function(){t.asyncSuccess({stream:e,width:i.videoWidth,height:i.videoHeight}),i.remove()},500)}),t},chromeExtensionMessage:function(e,t){var i=c.create();return chrome.runtime.sendMessage(e,t,i.asyncSuccessFunc()),i},chromeExtensionExtract:function(e){var t={};return h.isChrome()?(t.extensionId=e.chromeExtensionId,t.extensionInstallLink=e.chromeExtensionInstallLink):h.isOpera()&&(t.extensionId=e.operaExtensionId,t.extensionInstallLink=e.operaExtensionInstallLink),t},userMedia:function(e){var t=c.create(),e=this.globals().getUserMedia.call(this.globals().getUserMediaCtx,e,function(e){t.asyncSuccess(e)},function(e){t.asyncError(e)});try{e.then&&e.then(function(e){t.asyncSuccess(e)}),e["catch"]&&e["catch"](function(e){t.asyncError(e)})}catch(i){}return t},userMedia2:function(t){var i,e,r,n,a,o,s,d={};return t.audio&&(d.audio=t.audio),t.screen&&!t.video&&(t.video={}),t.video?(t.screen&&(t.video.width=t.video.width||window.innerWidth||document.body.clientWidth,t.video.height=t.video.height||window.innerHeight||document.body.clientHeight),h.isiOS()?(d.video={},t.video.width&&(d.video.width=t.video.width),t.video.height&&(d.video.height=t.video.height),t.video.frameRate&&(d.video.frameRate=t.video.frameRate),t.video.cameraFaceFront!==undefined&&(d.video.facingMode={exact:t.video.cameraFaceFront?"user":"environment"}),this.userMedia(d)):t.screen&&"undefined"!=typeof navigator.mediaDevices.getDisplayMedia?(i=c.create(),e=this,r="boolean"!=typeof t.audio||t.audio,"undefined"==typeof t.video.resizeMode&&(t.video.resizeMode="none"),n={cursor:"motion",resizeMode:t.video.resizeMode,displaySurface:"application"},0<parseInt(t.video.width,10)&&(n.width=parseInt(t.video.width,10)),0<parseInt(t.video.height,10)&&(n.height=parseInt(t.video.height,10)),(n=navigator.mediaDevices.getDisplayMedia({video:n,audio:r})).then(function(t){t.getAudioTracks().length<1&&r?e.userMedia({video:!1,audio:!0}).mapError(function(e){i.asyncSuccess(t)}).mapSuccess(function(e){i.asyncSuccess(new MediaStream([t.getTracks()[0],e.getAudioTracks()[0]]))}):i.asyncSuccess(t)}),n["catch"](function(e){i.asyncError(e)}),i):h.isFirefox()?(d.video={},!t.screen||(d.video.mediaSource="screen",navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().mediaSource)?(!t.video.aspectRatio||t.video.width&&t.video.height||(t.video.width?t.video.height=Math.round(t.video.width/t.video.aspectRatio):t.video.height&&(t.video.width=Math.round(t.video.height*t.video.aspectRatio))),t.video.width&&(d.video.width={ideal:t.video.width}),t.video.height&&(d.video.height={ideal:t.video.height}),t.video.frameRate&&(d.video.frameRate={ideal:t.video.frameRate}),t.video.sourceId&&(d.video.sourceId=t.video.sourceId,d.video.deviceId={exact:t.video.sourceId}),t.video.cameraFaceFront!==undefined&&h.isMobile()&&(d.video.facingMode={exact:t.video.cameraFaceFront?"user":"environment"}),this.userMedia(d)):c.error("This browser does not support screen recording.")):h.isEdge()&&t.screen?navigator.getDisplayMedia?(i=c.create(),(n=navigator.getDisplayMedia({video:!0})).then(i.asyncSuccessFunc()),n["catch"](i.asyncErrorFunc()),i):c.error("This browser does not support screen recording."):(h.isAndroid()?d.video={}:d.video={mandatory:{}},h.isSafari()&&t.video.sourceId&&(d.video.sourceId=t.video.sourceId,d.video.deviceId={exact:t.video.sourceId}),n=t.video.aspectRatio||(t.video.width&&t.video.height?t.video.width/t.video.height:null),"undefined"!=typeof d.video.mandatory?(t.video.width&&(d.video.mandatory.minWidth=t.video.width,d.video.mandatory.maxWidth=t.video.width),!t.video.width&&t.video.height&&(d.video.mandatory.minHeight=t.video.height,d.video.mandatory.maxHeight=t.video.height),t.video.frameRate&&(d.video.mandatory.minFrameRate=t.video.frameRate,d.video.mandatory.maxFrameRate=t.video.frameRate),t.video.sourceId&&(d.video.mandatory.sourceId=t.video.sourceId)):(t.video.cameraFaceFront!==undefined&&h.isMobile()&&(d.video.facingMode={exact:t.video.cameraFaceFront?"user":"environment"}),t.video.width&&(d.video.width=t.video.width),!t.video.width&&t.video.height&&(d.video.height=t.video.height),t.video.frameRate&&(d.video.frameRate=t.video.frameRate),t.video.sourceId&&(d.video.deviceId=t.video.sourceId)),n&&("undefined"!=typeof d.video.mandatory?(d.video.mandatory.minAspectRatio=n,d.video.mandatory.maxAspectRatio=n):t.video.aspectRatio||(d.video.aspectRatio=n)),a=function(o){var s="undefined"!=typeof d.video.mandatory?d.video.mandatory:d.video;return this.userMedia(d).mapError(function(e){var n;return o--,"ConstraintNotSatisfiedError"!==e.name&&"OverconstrainedError"!==e.name?e:(n=(e.constraintName||e.constraint).toLowerCase(),u.iter(s,function(e,t){var i,r=t.toLowerCase();0<=r.indexOf(n)&&(i=0<r.indexOf("aspect"),r=0===r.indexOf("min")?-1:1,r=Math.max(0,s[t]*(1+r/10)),s[t]=i?r:Math.round(r),o<0)&&(delete s[t],o=100)},this),a.call(this,o))},this)},t.screen?(o=this.chromeExtensionExtract(t.screen).extensionId)?(s=l.now(),this.chromeExtensionMessage(o,{type:"ping",data:s}).mapSuccess(function(e){return i=c.create(),e&&"success"===e.type&&e.data===s?(i.asyncSuccess(!0),i.mapSuccess(function(){return this.chromeExtensionMessage(o,{type:"acquire",sources:["window","screen","tab"],url:window.self!==window.top?window.location.href:null}).mapSuccess(function(e){return e&&"success"===e.type?(d.video.mandatory.chromeMediaSource="desktop",d.video.mandatory.chromeMediaSourceId=e.streamId,delete d.audio,a.call(this,100).mapSuccess(function(i){return t.audio?this.userMedia({audio:!0}).mapError(function(){return c.value(i)}).mapSuccess(function(e){try{return new MediaStream([i.getVideoTracks()[0],e.getAudioTracks()[0]])}catch(t){return i}}):i},this)):c.error("Could not acquire permission to access screen.")},this)},this)):c.error("This browser does not support screen recording.")},this)):c.error("This browser does not support screen recording."):a.call(this,100))):this.userMedia(d)},stopUserMediaStream:function(e,t){var i=!1;try{e.getTracks&&e.getTracks().forEach(function(e){e.stop(),i=!0}),0<t.length&&u.iter(t,function(e){e.stop(),i=!0},this)}catch(r){}try{!i&&e.stop&&e.stop()}catch(r){}},bindStreamToVideo:function(e,t,i){return(t=t||document.createElement("video")).volume=0,t.muted=!0,"mozSrcObject"in t?t.mozSrcObject=e:"srcObject"in t?t.srcObject=e:t.src=this.globals().URL.createObjectURL(e),i?(t.style["-moz-transform"]="scale(-1, 1)",t.style["-webkit-transform"]="scale(-1, 1)",t.style["-o-transform"]="scale(-1, 1)",t.style.transform="scale(-1, 1)",t.style.filter="FlipH"):(delete t.style["-moz-transform"],delete t.style["-webkit-transform"],delete t.style["-o-transform"],delete t.style.transform,delete t.style.filter),t.autoplay=!0,t.play(),t},dataURItoBlob:function(e){if(""!==e){for(var t=atob(e.split(",")[1]),e=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),r=new Uint8Array(i),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);i=new DataView(i);return new Blob([i],{type:e})}},errorHandler:function(e){switch(e){case"NotReadableError":case"TrackStartError":return{key:"device-already-in-use",message:"Web camera or microphone are already in use",userLevel:!0};case"NotFoundError":case"DevicesNotFoundError":return{key:"missing-track",message:"Required audio or video track is missing",userLevel:!0};case"OverconstrainedError":case"ConstraintNotSatisfiedError":return{key:"constrains-error",message:"Constraints can not be satisfied by available devices",userLevel:!1};case"NotAllowedError":case"PermissionDeniedError":return{key:"browser-permission-denied",message:"Permission denied by browser, please grant access to proceed",userLevel:!0};case"TypeError":return{key:"empty-constraints",message:"Empty constraints object",userLevel:!1};default:return{key:"unknown-error",message:"Unknown Error",userLevel:!1}}}}}),e.define("module:WebRTC.WhammyRecorder",["base:Class","base:Events.EventsMixin","base:Objs","base:Time","base:Functions","base:Promise","base:Async","module:WebRTC.Support","module:Encoding.WebmEncoder.Support"],function(e,t,r,n,i,o,s,a,c,d){return e.extend({scoped:d},[t,function(i){return{constructor:function(e,t){i.constructor.call(this),this._stream=e,this._options=r.extend({recordWidth:320,recordHeight:240,quality:undefined,video:null,framerate:null},t),this._started=!1},destroy:function(){this._started=!1,this.trigger("stopped"),i.destroy.call(this)},start:function(){return this._started||(this._started=!0,this._options.video&&(this._options.recordWidth=this._options.video.videoWidth||this._options.video.clientWidth,this._options.recordHeight=this._options.video.videoHeight||this._options.video.clientHeight),this._video=document.createElement("video"),this._video.width=this._options.recordWidth||80,this._video.height=this._options.recordHeight||60,this._stream&&a.bindStreamToVideo(this._stream,this._video),this._canvas=document.createElement("canvas"),this._canvas.width=this._options.recordWidth||80,this._canvas.height=this._options.recordHeight||60,this._context=this._canvas.getContext("2d"),this._frames=[],this._lastTime=n.now(),this._startTime=this._lastTime,this.trigger("started"),s.eventually(this._process,[],this)),o.value(!0)},stop:function(){this._started&&(this._started=!1,this.trigger("stopped"),this._generateData())},_process:function(){var e,t;this._started&&(t=(e=n.now())-this._lastTime,this._lastTime=e,this._context.drawImage(this._video,0,0,this._canvas.width,this._canvas.height),this._frames.push({duration:t,image:this._stream?this._canvas.toDataURL("image/webp",this._options.quality):"data:image/webp;base64,UklGRjwAAABXRUJQVlA4IDAAAADQAwCdASpQADwAPpFIoUylpCMiIagAsBIJaQAADHThw4cOHDhwrAAA/vhNAAAAAAA="}),t=this._options.framerate?1e3/this._options.framerate:10,s.eventually(this._process,[],this,Math.max(1,t-(n.now()-e))))},averageFrameRate:function(){return 0<this._frames.length?this._frames.length/(n.now()-this._startTime)*1e3:null},_generateData:function(){this._frames.length&&(this._data=this.__compile(this._stream?this.__dropBlackFrames(this._canvas,this._frames):this._frames),this.trigger("data",this._data))},__compile:function(e){var i=0,r=null,n=null,o=[],s=0,a=null,d=null,e=(e.forEach(function(e){a||(a=[],d=0);var t=c.parseWebP(c.parseRIFF(atob(e.image.slice(23))));a.push(c.serializeEBML(c.makeTimecodeDataBlock(t.data,d))),d+=e.duration,i+=e.duration,r=r||t.width,n=n||t.height,3e4<=d&&(o.push(c.serializeEBML(c.makeCluster(a,s))),s=i,a=null,d=0)},this),a&&o.push(c.serializeEBML(c.makeCluster(a,s))),c.generateEBMLHeader(i,r,n));return e[1].data=e[1].data.concat(o),c.serializeEBML(e)},__dropBlackFrames:function(e,t,i,r){for(var n=0;n<t.length&&c.isBlankFrame(e,t[n],i,r);)n++;return t.slice(n)},createSnapshot:function(e){return this._context.drawImage(this._video,0,0,this._canvas.width,this._canvas.height),this._canvas.toDataURL(e)}}}],{supported:function(e){return e||a.globals().webpSupport}})})}.call(Scoped);